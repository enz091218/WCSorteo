<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo de la Copa del Mundo - Panel de Control 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #001a4d 100%);
            color: #ffffff;
            padding: 12px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            flex: 1;
            height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 2.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.2rem;
            }
        }

        .header p {
            font-size: 0.95rem;
            color: #aaa;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .controls {
                gap: 6px;
                margin-bottom: 8px;
            }
        }

        @media (max-width: 480px) {
            .controls {
                gap: 4px;
                margin-bottom: 6px;
            }
        }

        .btn {
            padding: 14px 28px;
            font-size: 1.05rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        @media (max-width: 768px) {
            .btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .btn {
                padding: 8px 12px;
                font-size: 0.75rem;
            }
        }

        .btn-save {
            background: #ffffff;
            color: #000000;
        }

        .btn-save:hover {
            background: #e0e0e0;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        }

        .btn-clear {
            background: #ffffff;
            color: #000000;
        }

        .btn-clear:hover {
            background: #e0e0e0;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        }

        .btn-random {
            background: #ffaa00;
            color: #000000;
            font-weight: 600;
        }

        .btn-random:hover {
            background: #ff9900;
            box-shadow: 0 0 20px rgba(255, 170, 0, 0.7);
        }

        .btn-transforms {
            background: #00d9ff;
            color: #000000;
            font-weight: 600;
        }

        .btn-transforms:hover {
            background: #00b8d4;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.7);
        }

        .transforms-modal-content {
            max-width: 900px;
            max-height: 85vh;
        }

        .transforms-content {
            max-height: calc(85vh - 100px);
            overflow-y: auto;
            padding: 20px;
        }

        .transforms-section {
            margin-bottom: 30px;
        }

        .transforms-section h3 {
            color: #00d9ff;
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            padding-bottom: 10px;
        }

        .transform-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .transform-group h4 {
            color: #ffffff;
            font-size: 1rem;
            margin: 0 0 10px 0;
        }

        .transform-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .transform-control {
            display: flex;
            flex-direction: column;
        }

        .transform-control label {
            color: #ccc;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .transform-control input {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .transform-control input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 5px rgba(0, 217, 255, 0.5);
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            flex: 1;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .groups-grid {
                grid-template-columns: repeat(2, 1fr);
                overflow-y: auto;
            }
        }

        @media (max-width: 480px) {
            .groups-grid {
                grid-template-columns: 1fr;
                overflow-y: auto;
            }
        }

        .group-panel {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .group-panel.highlighted {
            background: rgba(0, 217, 255, 0.2);
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
        }

        .group-panel h3 {
            font-size: 1.25rem;
            color: #ffffff;
            margin-bottom: 8px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #ffffff;
            flex-shrink: 0;
        }

        .input-group {
            margin-bottom: 8px;
            position: relative;
            flex-shrink: 0;
        }

        .input-group label {
            display: none;
            font-size: 0.7rem;
            color: #aaa;
            margin-bottom: 2px;
        }

        .team-input {
            width: 100%;
            padding: 10px;
            font-size: 0.95rem;
            font-family: 'Poppins', sans-serif;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #ffffff;
            border-radius: 4px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .team-input:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .team-input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .team-input::placeholder {
            color: #666;
        }

        .team-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .team-input-wrapper .team-input {
            flex: 1;
        }

        .team-input-flag {
            width: 32px;
            height: 20px;
            border-radius: 2px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(26, 26, 26, 0.95);
            border: 2px solid #ffffff;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px rgba(0, 217, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: #ffffff;
        }

        .close-btn {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #00d9ff;
        }

        .modal-search {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #ffffff;
            border-radius: 6px;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .search-input::placeholder {
            color: #666;
        }

        .modal-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .team-item {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .team-item:hover {
            background: rgba(0, 217, 255, 0.1);
        }

        .team-item:last-child {
            border-bottom: none;
        }

        .team-flag {
            width: 40px;
            height: 25px;
            border-radius: 3px;
            flex-shrink: 0;
            object-fit: cover;
            transition: filter 0.3s ease;
        }

        .team-item.assigned .team-flag {
            filter: grayscale(100%);
        }

        .team-item.assigned span {
            color: #888888;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .status-message.success {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #ffffff;
            color: #ffffff;
            display: block;
        }

        .status-message.error {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #ffffff;
            color: #ffffff;
            display: block;
        }

        .bombo-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        @media (max-width: 768px) {
            .bombo-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            .bombo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
                padding: 6px;
            }
        }

        .bombo-country {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bombo-country:hover {
            background: rgba(0, 217, 255, 0.15);
            border-color: rgba(0, 217, 255, 0.5);
            transform: translateY(-2px);
        }

        .bombo-country.highlighted {
            background: rgba(255, 215, 0, 0.3);
            border-color: gold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .bombo-country.assigned {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bombo-country.assigned:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .bombo-flag {
            width: 48px;
            height: 32px;
            border-radius: 4px;
            object-fit: cover;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: filter 0.3s ease;
        }

        .bombo-country.assigned .bombo-flag {
            filter: grayscale(100%);
        }

        .bombo-name {
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            color: #ffffff;
            line-height: 1.2;
            transition: color 0.3s ease;
        }

        .bombo-country.assigned .bombo-name {
            color: #888888;
        }

        .delete-team-btn {
            background: rgba(255, 50, 50, 0.8);
            border: 1px solid rgba(255, 100, 100, 0.5);
            border-radius: 50%;
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: bold;
            width: 24px;
            height: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }

        .delete-team-btn:hover {
            background: rgba(255, 50, 50, 1);
            box-shadow: 0 0 10px rgba(255, 50, 50, 0.7);
            transform: scale(1.1);
        }

        .highlight-group-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #ffffff;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: auto;
            font-family: 'Poppins', sans-serif;
        }

        .highlight-group-btn:hover {
            background: rgba(0, 217, 255, 0.3);
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .bombo-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .bombo-btn {
            padding: 14px 24px;
            font-size: 1rem;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .bombo-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(0, 217, 255, 0.5);
            transform: translateY(-2px);
        }

        .bombo-btn.active {
            background: rgba(0, 217, 255, 0.3);
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
            color: #00d9ff;
        }

        @media (max-width: 768px) {
            .bombo-btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        /* Drag and Drop Styles */
        .bombo-country.dragging {
            opacity: 0.4;
            cursor: grabbing;
            transform: scale(0.95);
        }

        .bombo-country:not(.assigned) {
            cursor: grab;
        }

        .bombo-country:not(.assigned):active {
            cursor: grabbing;
        }

        .team-input-wrapper.drag-over {
            background: rgba(0, 217, 255, 0.2);
            border-color: #00d9ff;
            border-style: dashed;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
        }

        .team-input.drop-zone {
            cursor: copy;
        }

        @media (max-width: 480px) {
            .bombo-btn {
                padding: 8px 12px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            .bombo-flag {
                width: 40px;
                height: 27px;
            }
            .bombo-name {
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            .bombo-flag {
                width: 36px;
                height: 24px;
            }
            .bombo-name {
                font-size: 0.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="bomboGridContainer" class="bombo-grid">
            <!-- Los pa√≠ses del bombo se generar√°n din√°micamente aqu√≠ -->
        </div>

        <div id="statusMessage" class="status-message"></div>

        <div class="controls">
            <div class="bombo-buttons">
                <button class="bombo-btn active" id="bombo-btn-1" onclick="setBombo(1)">Bombo 1</button>
                <button class="bombo-btn" id="bombo-btn-2" onclick="setBombo(2)">Bombo 2</button>
                <button class="bombo-btn" id="bombo-btn-3" onclick="setBombo(3)">Bombo 3</button>
                <button class="bombo-btn" id="bombo-btn-4" onclick="setBombo(4)">Bombo 4</button>
            </div>
            <button class="btn btn-clear" onclick="clearAll()">Limpiar Todo</button>
            <button class="btn btn-random" onclick="fillRandom()">Llenar Random</button>
            <button class="btn btn-transforms" onclick="openTransformsPanel()">‚öôÔ∏è Controles Overlay 3</button>
        </div>

        <div class="groups-grid" id="groupsGrid">
        </div>
    </div>

    <div id="teamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Seleccionar Equipo</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-search">
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar equipo..." oninput="filterTeams()">
            </div>
            <div class="modal-list" id="teamList">
            </div>
        </div>
    </div>

    <!-- Panel de Controles de Transformaciones para Overlay 3 -->
    <div id="transformsModal" class="modal">
        <div class="modal-content transforms-modal-content">
            <div class="modal-header">
                <h2>Posicionamiento Absoluto - Overlay 3 (1920x1080)</h2>
                <button class="close-btn" onclick="closeTransformsPanel()">&times;</button>
            </div>
            <div class="transforms-content">
                <div class="transforms-section">
                    <h3>Grupos (A-L)</h3>
                    <p style="color: #00f5ff; font-size: 0.9em; margin: 10px 0;">Coordenadas de esquina superior izquierda</p>
                    <div id="groupsTransformsContainer"></div>
                </div>
                <div class="transforms-section">
                    <h3>Bombos (1-4)</h3>
                    <p style="color: #00f5ff; font-size: 0.9em; margin: 10px 0;">Coordenadas de esquina superior izquierda</p>
                    <div id="bombosTransformsContainer"></div>
                </div>
                <div class="transforms-section">
                    <h3>üèÅ Banderas de Bombos (CSS)</h3>
                    <p style="color: #00f5ff; font-size: 0.9em; margin: 10px 0;">Posici√≥n absoluta en canvas 1920x1080</p>
                    <div id="bomboFlagsConfigContainer"></div>
                </div>
                <div class="transforms-section">
                    <h3>‚ú® Resplandor de Bandera</h3>
                    <p style="color: #00f5ff; font-size: 0.9em; margin: 10px 0;">Posici√≥n y tama√±o del resplandor de colores</p>
                    <div id="glowConfigContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const teams = [
            "Alemania", "A. Saudita", "Argelia", "Argentina", "Australia", "Austria",
            "B√©lgica", "Brasil", "Cabo Verde", "Canad√°", "Catar", "Colombia",
            "Costa de Marfil", "Croacia", "Curazao", "Ecuador", "Egipto", "Escocia",
            "Espa√±a", "Estados Unidos", "Francia", "Ghana", "Hait√≠", "Inglaterra",
            "Ir√°n", "Jap√≥n", "Jordania", "Marruecos", "M√©xico", "Noruega",
            "Nueva Zelanda", "Pa√≠ses Bajos", "Panam√°", "Paraguay", "Portugal",
            "Rep√∫blica de Corea", "Senegal", "Sud√°frica", "Suiza", "T√∫nez", "Uruguay", "Uzbekist√°n",
            "R. EUROPA 1", "R. EUROPA 2", "R. EUROPA 3", "R. EUROPA 4", "R. INTERCONT 1", "R. INTERCONT 2"
        ];

        const countryToCode = {
            "Alemania": "de", "A. Saudita": "sa", "Argelia": "dz", "Argentina": "ar", "Australia": "au",
            "Austria": "at", "B√©lgica": "be", "Brasil": "br", "Cabo Verde": "cv", "Canad√°": "ca",
            "Catar": "qa", "Colombia": "co", "Costa de Marfil": "ci", "Croacia": "hr", "Curazao": "cw",
            "Ecuador": "ec", "Egipto": "eg", "Escocia": "gb-sct", "Espa√±a": "es", "Estados Unidos": "us",
            "Francia": "fr", "Ghana": "gh", "Hait√≠": "ht", "Inglaterra": "gb-eng", "Ir√°n": "ir",
            "Jap√≥n": "jp", "Jordania": "jo", "Marruecos": "ma", "M√©xico": "mx", "Noruega": "no",
            "Nueva Zelanda": "nz", "Pa√≠ses Bajos": "nl", "Panam√°": "pa", "Paraguay": "py", "Portugal": "pt",
            "Rep√∫blica de Corea": "kr", "Senegal": "sn", "Sud√°frica": "za", "Suiza": "ch", "T√∫nez": "tn",
            "Uruguay": "uy", "Uzbekist√°n": "uz",
            "R. EUROPA 1": "uefa", "R. EUROPA 2": "uefa", "R. EUROPA 3": "uefa", "R. EUROPA 4": "uefa",
            "R. INTERCONT 1": "fifa", "R. INTERCONT 2": "fifa"
        };

        const bombos = {
            1: ["Espa√±a", "Argentina", "Francia", "Inglaterra", "Brasil", "Portugal", "Pa√≠ses Bajos", "B√©lgica", "Alemania", "Estados Unidos", "M√©xico", "Canad√°"],
            2: ["Croacia", "Marruecos", "Colombia", "Uruguay", "Suiza", "Jap√≥n", "Senegal", "Ir√°n", "Rep√∫blica de Corea", "Ecuador", "Austria", "Australia"],
            3: ["Noruega", "Panam√°", "Egipto", "Argelia", "Escocia", "Paraguay", "T√∫nez", "Costa de Marfil", "Uzbekist√°n", "Catar", "A. Saudita", "Sud√°frica"],
            4: ["Jordania", "Cabo Verde", "Ghana", "Curazao", "Hait√≠", "Nueva Zelanda", "R. EUROPA 1", "R. EUROPA 2", "R. EUROPA 3", "R. EUROPA 4", "R. INTERCONT 1", "R. INTERCONT 2"]
        };

        const groupLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];
        let currentInput = null;
        let groups = {};
        let highlightedCountryIndex = -1;
        
        const socket = io();

        groupLetters.forEach(letter => {
            groups[letter] = ['', '', '', ''];
        });

        socket.on('groups_update', (data) => {
            console.log('Data updated from server');
            groups = JSON.parse(JSON.stringify(data));
            render();
            renderBomboGrid(getCurrentBombo()); // Actualizar bombo grid cuando cambian los grupos
        });

        socket.on('bombo_update', (bomboNumber) => {
            console.log('Bombo updated:', bomboNumber);
            updateBomboButtons(bomboNumber);
            renderBomboGrid(bomboNumber);
        });

        socket.on('highlighted_group_update', (group) => {
            console.log('Highlighted group updated:', group);
            highlightedGroup = group;
            render();
        });

        function setBombo(bomboNumber) {
            socket.emit('set_bombo', bomboNumber);
            updateBomboButtons(bomboNumber);
            renderBomboGrid(bomboNumber);
        }

        function updateBomboButtons(activeBombo) {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`bombo-btn-${i}`);
                if (btn) {
                    if (i === activeBombo) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                }
            }
        }

        function getCurrentBombo() {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`bombo-btn-${i}`);
                if (btn && btn.classList.contains('active')) {
                    return i;
                }
            }
            return 1; // Default
        }

        function isTeamAssigned(teamName) {
            // Verificar si el equipo ya est√° en alg√∫n grupo
            for (const groupLetter of groupLetters) {
                if (groups[groupLetter].includes(teamName)) {
                    return true;
                }
            }
            return false;
        }

        function renderBomboGrid(bomboNumber) {
            const container = document.getElementById('bomboGridContainer');
            const bomboTeams = bombos[bomboNumber] || [];
            
            container.innerHTML = '';
            
            bomboTeams.forEach((teamName, index) => {
                const countryDiv = document.createElement('div');
                countryDiv.className = 'bombo-country';
                countryDiv.dataset.countryIndex = index;
                countryDiv.dataset.teamName = teamName;
                
                // Verificar si el pa√≠s ya est√° asignado a un grupo
                const assigned = isTeamAssigned(teamName);
                if (assigned) {
                    countryDiv.classList.add('assigned');
                } else {
                    // Hacer draggable solo si no est√° asignado
                    countryDiv.draggable = true;
                    
                    // Evento dragstart: guardar el nombre del equipo
                    countryDiv.addEventListener('dragstart', (e) => {
                        e.dataTransfer.effectAllowed = 'copy';
                        e.dataTransfer.setData('text/plain', teamName);
                        countryDiv.classList.add('dragging');
                        console.log('Dragging team:', teamName);
                    });
                    
                    // Evento dragend: remover clase visual
                    countryDiv.addEventListener('dragend', (e) => {
                        countryDiv.classList.remove('dragging');
                    });
                }
                
                // Resaltar si es el pa√≠s seleccionado
                if (index === highlightedCountryIndex) {
                    countryDiv.classList.add('highlighted');
                }
                
                // Click handler para resaltar el pa√≠s
                countryDiv.onclick = () => highlightCountry(index);
                
                const flag = document.createElement('img');
                flag.className = 'bombo-flag';
                if (countryToCode[teamName]) {
                    flag.src = `/w2560/${countryToCode[teamName]}.png`;
                } else {
                    flag.src = '/w2560/inc.png';
                }
                flag.alt = teamName;
                
                const name = document.createElement('div');
                name.className = 'bombo-name';
                name.textContent = teamName;
                
                countryDiv.appendChild(flag);
                countryDiv.appendChild(name);
                container.appendChild(countryDiv);
            });
        }

        function highlightCountry(countryIndex) {
            // Toggle: si ya est√° destacado, quitarlo
            if (highlightedCountryIndex === countryIndex) {
                highlightedCountryIndex = -1;
                socket.emit('set_highlighted_country', -1);
            } else {
                highlightedCountryIndex = countryIndex;
                socket.emit('set_highlighted_country', countryIndex);
            }
            
            // Actualizar visualmente
            document.querySelectorAll('.bombo-country').forEach((div, idx) => {
                if (idx === highlightedCountryIndex) {
                    div.classList.add('highlighted');
                } else {
                    div.classList.remove('highlighted');
                }
            });
        }


        function openModal(inputElement, index) {
            currentInput = { element: inputElement, groupIndex: index };
            document.getElementById('teamModal').classList.add('show');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').focus();
            // Mostrar solo equipos del bombo actual
            const currentBombo = getCurrentBombo();
            const bomboTeams = bombos[currentBombo] || [];
            renderTeamList(bomboTeams);
        }

        function closeModal() {
            document.getElementById('teamModal').classList.remove('show');
            currentInput = null;
        }

        function renderTeamList(filteredTeams) {
            const list = document.getElementById('teamList');
            list.innerHTML = '';
            filteredTeams.forEach(team => {
                const item = document.createElement('div');
                item.className = 'team-item';
                
                // Verificar si el equipo ya est√° asignado
                if (isTeamAssigned(team)) {
                    item.classList.add('assigned');
                }
                
                const flag = document.createElement('img');
                flag.className = 'team-flag';
                if (countryToCode[team]) {
                    flag.src = `/w2560/${countryToCode[team]}.png`;
                }
                flag.alt = team;
                
                const name = document.createElement('span');
                name.textContent = team;
                
                item.appendChild(flag);
                item.appendChild(name);
                item.onclick = () => selectTeam(team);
                list.appendChild(item);
            });
        }

        function filterTeams() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const currentBombo = getCurrentBombo();
            const bomboTeams = bombos[currentBombo] || [];
            
            // Filtrar dentro del bombo actual
            const startsWithTerm = bomboTeams.filter(team => team.toLowerCase().startsWith(searchTerm));
            const containsTerm = bomboTeams.filter(team => 
                team.toLowerCase().includes(searchTerm) && !team.toLowerCase().startsWith(searchTerm)
            );
            
            // Primero mostrar los que empiezan con el t√©rmino, luego los dem√°s
            const filtered = [...startsWithTerm, ...containsTerm];
            renderTeamList(filtered);
        }

        // Funci√≥n compartida para asignar equipos a grupos
        // Funci√≥n compartida para asignar equipos a grupos
        // Funci√≥n compartida para asignar equipos a grupos
        function assignTeamToGroup(groupLetter, teamIndex, teamName) {
            // Validar que el equipo no est√© ya asignado a otro grupo
            if (isTeamAssigned(teamName)) {
                console.log(`Cannot assign ${teamName}: already assigned to another group`);
                return false;
            }

            // Asignar el equipo al grupo (modelo local)
            groups[groupLetter][teamIndex] = teamName;

            // Buscar el pa√≠s en todos los bombos para saber desde d√≥nde "sale"
            let teamBomboNum = -1;
            let teamIndexInBombo = -1;

            for (let bomboNum = 1; bomboNum <= 4; bomboNum++) {
                const bomboTeams = bombos[bomboNum] || [];
                const idx = bomboTeams.indexOf(teamName);

                if (idx !== -1) {
                    teamBomboNum = bomboNum;
                    teamIndexInBombo = idx;
                    break;
                }
            }

            const currentBombo = getCurrentBombo();

            if (teamBomboNum !== -1) {
                // Limpiar highlight actual para forzar un nuevo highlight (no toggle)
                highlightedCountryIndex = -1;
                socket.emit('set_highlighted_country', -1);

                // Si el pa√≠s est√° en el bombo actual, resaltarlo directamente
                if (teamBomboNum === currentBombo) {
                    setTimeout(() => {
                        highlightCountry(teamIndexInBombo);

                        const highlightedIndex = teamIndexInBombo;

                        setTimeout(() => {
                            if (highlightedCountryIndex === highlightedIndex) {
                                highlightedCountryIndex = -1;
                                socket.emit('set_highlighted_country', -1);
                                renderBomboGrid(getCurrentBombo());
                                render();
                            }
                        }, 3000);
                    }, 50);
                } else {
                    // Cambiar de bombo
                    setBombo(teamBomboNum);

                    setTimeout(() => {
                        highlightCountry(teamIndexInBombo);

                        const highlightedIndex = teamIndexInBombo;

                        setTimeout(() => {
                            if (highlightedCountryIndex === highlightedIndex) {
                                highlightedCountryIndex = -1;
                                socket.emit('set_highlighted_country', -1);
                                renderBomboGrid(getCurrentBombo());
                                render();
                            }
                        }, 3000);
                    }, 150);
                }
            } else {
                // El pa√≠s no est√° en ning√∫n bombo, no resaltar ning√∫n pa√≠s
                highlightedCountryIndex = -1;
                socket.emit('set_highlighted_country', -1);
                render();
                renderBomboGrid(getCurrentBombo());
            }

            // Auto-desdestacado del grupo si estaba destacado
            if (highlightedGroup === groupLetter) {
                const targetGroup = groupLetter;
                setTimeout(() => {
                    if (highlightedGroup === targetGroup) {
                        highlightedGroup = '';
                        socket.emit('set_highlighted_group', '');
                        render();
                    }
                }, 3000);
            }

            // 1) Sincronizar cambios de grupos con el servidor
            socket.emit('update_groups', groups);

            // 2) Avisar al overlay que este equipo viaj√≥ del bombo al grupo
            if (teamBomboNum !== -1 && teamIndexInBombo !== -1) {
                socket.emit('team_transfer', {
                    teamName: teamName,          // ej. "Argentina"
                    fromBombo: teamBomboNum,     // 1..4
                    fromIndex: teamIndexInBombo, // 0..11
                    toGroup: groupLetter,        // 'A'..'L'
                    toSlot: teamIndex            // 0..3
                });
            }

            return true;
        }



        function selectTeam(team) {
            if (currentInput) {
                const groupLetter = currentInput.element.dataset.group;
                const teamIndex = parseInt(currentInput.element.dataset.index);
                
                assignTeamToGroup(groupLetter, teamIndex, team);
                closeModal();
            }
        }

        let highlightedGroup = '';

        function render() {
            const grid = document.getElementById('groupsGrid');
            grid.innerHTML = '';

            groupLetters.forEach(letter => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group-panel';
                if (highlightedGroup === letter) {
                    groupDiv.classList.add('highlighted');
                }
                groupDiv.innerHTML = `<h3>Grupo ${letter}</h3>`;

                groups[letter].forEach((team, index) => {
                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'input-group';

                    const label = document.createElement('label');
                    label.textContent = `Equipo ${index + 1}`;

                    const wrapper = document.createElement('div');
                    wrapper.className = 'team-input-wrapper';
                    wrapper.dataset.group = letter;
                    wrapper.dataset.index = index;
                    
                    // Hacer el wrapper una drop zone para drag and drop
                    wrapper.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'copy';
                        wrapper.classList.add('drag-over');
                    });
                    
                    wrapper.addEventListener('dragleave', (e) => {
                        // Solo remover si realmente salimos del wrapper
                        const rect = wrapper.getBoundingClientRect();
                        const x = e.clientX;
                        const y = e.clientY;
                        
                        // Verificar si el mouse est√° fuera de los l√≠mites del wrapper
                        if (x < rect.left || x >= rect.right || y < rect.top || y >= rect.bottom) {
                            wrapper.classList.remove('drag-over');
                        }
                    });
                    
                    wrapper.addEventListener('drop', (e) => {
                        e.preventDefault();
                        wrapper.classList.remove('drag-over');
                        
                        const teamName = e.dataTransfer.getData('text/plain');
                        const currentTeam = groups[letter][index];
                        
                        if (teamName) {
                            // Advertir si vamos a sobrescribir un equipo existente
                            if (currentTeam && currentTeam !== '') {
                                if (!confirm(`¬øDeseas reemplazar "${currentTeam}" con "${teamName}"?`)) {
                                    return;
                                }
                            }
                            
                            // Guardar el equipo actual en caso de que la asignaci√≥n falle
                            const previousTeam = groups[letter][index];
                            
                            // Limpiar el slot temporalmente para que assignTeamToGroup no detecte duplicado
                            groups[letter][index] = '';
                            
                            // Usar la funci√≥n compartida para asignar el equipo
                            const success = assignTeamToGroup(letter, index, teamName);
                            
                            if (success) {
                                console.log(`Dropped ${teamName} into Group ${letter}, slot ${index + 1}`);
                            } else {
                                // Si fall√≥, restaurar el equipo anterior
                                groups[letter][index] = previousTeam;
                                render();
                            }
                        }
                    });

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'team-input';
                    input.value = team;
                    input.placeholder = `Selecciona equipo ${index + 1}`;
                    input.readOnly = true;
                    input.dataset.group = letter;
                    input.dataset.index = index;
                    input.onclick = () => openModal(input, index);

                    wrapper.appendChild(input);

                    if (team && countryToCode[team]) {
                        const flag = document.createElement('img');
                        flag.className = 'team-input-flag';
                        flag.src = `/w2560/${countryToCode[team]}.png`;
                        flag.alt = team;
                        wrapper.appendChild(flag);
                    }

                    // Bot√≥n de eliminar equipo
                    if (team) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete-team-btn';
                        deleteBtn.textContent = '√ó';
                        deleteBtn.onclick = (e) => {
                            e.stopPropagation();
                            deleteTeam(letter, index);
                        };
                        wrapper.appendChild(deleteBtn);
                    }

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(wrapper);
                    groupDiv.appendChild(inputGroup);
                });

                // Bot√≥n de destacar grupo
                const highlightBtn = document.createElement('button');
                highlightBtn.className = 'highlight-group-btn';
                highlightBtn.textContent = highlightedGroup === letter ? 'No destacado' : 'Destacar';
                highlightBtn.onclick = () => toggleHighlightGroup(letter);
                groupDiv.appendChild(highlightBtn);

                grid.appendChild(groupDiv);
            });
        }

        function toggleHighlightGroup(letter) {
            if (highlightedGroup === letter) {
                highlightedGroup = '';
            } else {
                highlightedGroup = letter;
            }
            socket.emit('set_highlighted_group', highlightedGroup);
            render();
        }

        function deleteTeam(groupLetter, index) {
            groups[groupLetter][index] = '';
            socket.emit('update_groups', groups);
            render();
            renderBomboGrid(getCurrentBombo()); // Actualizar bombo grid
        }

        function saveChanges() {
            socket.emit('update_groups', groups);
            showStatus('¬°Cambios guardados exitosamente!', 'success');
        }

        function clearAll() {
            if (confirm('¬øDeseas limpiar todos los equipos?')) {
                groupLetters.forEach(letter => {
                    groups[letter] = ['', '', '', ''];
                });
                highlightedCountryIndex = -1;
                highlightedGroup = '';
                socket.emit('update_groups', groups);
                socket.emit('set_highlighted_country', -1);
                socket.emit('set_highlighted_group', '');
                render();
                renderBomboGrid(getCurrentBombo()); // Actualizar bombo grid
                showStatus('¬°Todos los equipos han sido limpiados!', 'success');
            }
        }

        function fillRandom() {
            if (confirm('¬øDeseas llenar todos los grupos de manera aleatoria?\n\nEsto distribuir√° los 48 pa√≠ses de los 4 bombos en los 12 grupos de forma aleatoria.')) {
                // Recopilar todos los pa√≠ses de los 4 bombos
                let allCountries = [];
                for (let bomboNum = 1; bomboNum <= 4; bomboNum++) {
                    allCountries = allCountries.concat(bombos[bomboNum]);
                }

                // Mezclar aleatoriamente usando algoritmo Fisher-Yates
                for (let i = allCountries.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allCountries[i], allCountries[j]] = [allCountries[j], allCountries[i]];
                }

                // Distribuir en los 12 grupos (4 pa√≠ses por grupo)
                let countryIndex = 0;
                groupLetters.forEach(letter => {
                    groups[letter] = [
                        allCountries[countryIndex++] || '',
                        allCountries[countryIndex++] || '',
                        allCountries[countryIndex++] || '',
                        allCountries[countryIndex++] || ''
                    ];
                });

                // Limpiar highlights
                highlightedCountryIndex = -1;
                highlightedGroup = '';

                // Emitir cambios al servidor
                socket.emit('update_groups', groups);
                socket.emit('set_highlighted_country', -1);
                socket.emit('set_highlighted_group', '');
                
                render();
                renderBomboGrid(getCurrentBombo());
                showStatus('¬°Grupos llenados aleatoriamente!', 'success');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
            setTimeout(() => {
                statusDiv.className = 'status-message';
            }, 3000);
        }

        document.getElementById('teamModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('teamModal')) {
                closeModal();
            }
        });

        // Listener global para limpiar estados drag-over cuando termina cualquier arrastre
        document.addEventListener('dragend', () => {
            // Remover clase drag-over de todos los wrappers
            document.querySelectorAll('.team-input-wrapper.drag-over').forEach(wrapper => {
                wrapper.classList.remove('drag-over');
            });
        });

        // ===== CONTROLES DE TRANSFORMACIONES PARA OVERLAY 3 =====
        
        let transformsData = {
            groups: {},
            bombos: {}
        };
        
        let bomboFlagsConfig = {
            offsetX: -300,
            offsetY: -205,
            columnSpacing: 155,
            rowSpacing: 45,
            width: 48,
            height: 32
        };
        
        let glowConfig = {
            x: 960,
            y: 540,
            width: 600,
            height: 400
        };

        // Abrir panel de transformaciones
        function openTransformsPanel() {
            document.getElementById('transformsModal').style.display = 'flex';
            generateTransformControls();
        }

        // Cerrar panel de transformaciones
        function closeTransformsPanel() {
            document.getElementById('transformsModal').style.display = 'none';
        }

        // Generar controles de transformaciones (coordenadas absolutas en pantalla 1920x1080)
        function generateTransformControls() {
            // Generar controles para grupos
            const groupsContainer = document.getElementById('groupsTransformsContainer');
            groupsContainer.innerHTML = '';
            
            ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'].forEach(letter => {
                const transform = transformsData.groups[letter] || { x: 0, y: 0, scaleX: 1, scaleY: 1 };
                const groupDiv = document.createElement('div');
                groupDiv.className = 'transform-group';
                groupDiv.innerHTML = `
                    <h4>Grupo ${letter}</h4>
                    <div class="transform-controls">
                        <div class="transform-control">
                            <label>X (0-1920):</label>
                            <input type="number" id="group-${letter}-x" value="${transform.x}" step="10" min="0" max="1920" onchange="updateTransform('group', '${letter}')">
                        </div>
                        <div class="transform-control">
                            <label>Y (0-1080):</label>
                            <input type="number" id="group-${letter}-y" value="${transform.y}" step="10" min="0" max="1080" onchange="updateTransform('group', '${letter}')">
                        </div>
                        <div class="transform-control">
                            <label>Escala X:</label>
                            <input type="number" id="group-${letter}-scaleX" value="${transform.scaleX}" step="0.01" min="0.1" max="3" onchange="updateTransform('group', '${letter}')">
                        </div>
                        <div class="transform-control">
                            <label>Escala Y:</label>
                            <input type="number" id="group-${letter}-scaleY" value="${transform.scaleY}" step="0.01" min="0.1" max="3" onchange="updateTransform('group', '${letter}')">
                        </div>
                    </div>
                `;
                groupsContainer.appendChild(groupDiv);
            });

            // Generar controles para bombos
            const bombosContainer = document.getElementById('bombosTransformsContainer');
            bombosContainer.innerHTML = '';
            
            [1, 2, 3, 4].forEach(num => {
                const transform = transformsData.bombos[num] || { x: 0, y: 0, scaleX: 1, scaleY: 1 };
                const bomboDiv = document.createElement('div');
                bomboDiv.className = 'transform-group';
                bomboDiv.innerHTML = `
                    <h4>Bombo ${num}</h4>
                    <div class="transform-controls">
                        <div class="transform-control">
                            <label>X (0-1920):</label>
                            <input type="number" id="bombo-${num}-x" value="${transform.x}" step="10" min="0" max="1920" onchange="updateTransform('bombo', ${num})">
                        </div>
                        <div class="transform-control">
                            <label>Y (0-1080):</label>
                            <input type="number" id="bombo-${num}-y" value="${transform.y}" step="10" min="0" max="1080" onchange="updateTransform('bombo', ${num})">
                        </div>
                        <div class="transform-control">
                            <label>Escala X:</label>
                            <input type="number" id="bombo-${num}-scaleX" value="${transform.scaleX}" step="0.01" min="0.1" max="3" onchange="updateTransform('bombo', ${num})">
                        </div>
                        <div class="transform-control">
                            <label>Escala Y:</label>
                            <input type="number" id="bombo-${num}-scaleY" value="${transform.scaleY}" step="0.01" min="0.1" max="3" onchange="updateTransform('bombo', ${num})">
                        </div>
                    </div>
                `;
                bombosContainer.appendChild(bomboDiv);
            });
            
            // Generar controles para banderas CSS de bombos
            const flagsContainer = document.getElementById('bomboFlagsConfigContainer');
            flagsContainer.innerHTML = '';
            
            const flagsDiv = document.createElement('div');
            flagsDiv.className = 'transform-group';
            flagsDiv.innerHTML = `
                <h4>Configuraci√≥n de Banderas</h4>
                <div class="transform-controls">
                    <div class="transform-control">
                        <label>Offset X:</label>
                        <input type="number" id="flags-offsetX" value="${bomboFlagsConfig.offsetX}" step="10" onchange="updateBomboFlagsConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Offset Y:</label>
                        <input type="number" id="flags-offsetY" value="${bomboFlagsConfig.offsetY}" step="10" onchange="updateBomboFlagsConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Separaci√≥n Columnas:</label>
                        <input type="number" id="flags-columnSpacing" value="${bomboFlagsConfig.columnSpacing}" step="5" min="50" max="300" onchange="updateBomboFlagsConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Separaci√≥n Filas:</label>
                        <input type="number" id="flags-rowSpacing" value="${bomboFlagsConfig.rowSpacing}" step="5" min="20" max="100" onchange="updateBomboFlagsConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Ancho Bandera:</label>
                        <input type="number" id="flags-width" value="${bomboFlagsConfig.width}" step="2" min="20" max="150" onchange="updateBomboFlagsConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Alto Bandera:</label>
                        <input type="number" id="flags-height" value="${bomboFlagsConfig.height}" step="2" min="15" max="100" onchange="updateBomboFlagsConfig()">
                    </div>
                </div>
            `;
            flagsContainer.appendChild(flagsDiv);
            
            // Generar controles para resplandor de bandera
            const glowContainer = document.getElementById('glowConfigContainer');
            glowContainer.innerHTML = '';
            
            const glowDiv = document.createElement('div');
            glowDiv.className = 'transform-group';
            glowDiv.innerHTML = `
                <h4>Configuraci√≥n del Resplandor</h4>
                <div class="transform-controls">
                    <div class="transform-control">
                        <label>Centro X (0-1920):</label>
                        <input type="number" id="glow-x" value="${glowConfig.x}" step="10" min="0" max="1920" onchange="updateGlowConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Centro Y (0-1080):</label>
                        <input type="number" id="glow-y" value="${glowConfig.y}" step="10" min="0" max="1080" onchange="updateGlowConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Ancho:</label>
                        <input type="number" id="glow-width" value="${glowConfig.width}" step="50" min="100" max="1500" onchange="updateGlowConfig()">
                    </div>
                    <div class="transform-control">
                        <label>Alto:</label>
                        <input type="number" id="glow-height" value="${glowConfig.height}" step="50" min="100" max="1000" onchange="updateGlowConfig()">
                    </div>
                </div>
            `;
            glowContainer.appendChild(glowDiv);
        }

        // Actualizar transformaci√≥n y enviar al servidor
        function updateTransform(type, id) {
            const x = parseFloat(document.getElementById(`${type}-${id}-x`).value) || 0;
            const y = parseFloat(document.getElementById(`${type}-${id}-y`).value) || 0;
            const scaleX = parseFloat(document.getElementById(`${type}-${id}-scaleX`).value) || 1;
            const scaleY = parseFloat(document.getElementById(`${type}-${id}-scaleY`).value) || 1;

            const transform = { x, y, scaleX, scaleY };

            // Actualizar datos locales
            if (type === 'group') {
                transformsData.groups[id] = transform;
            } else if (type === 'bombo') {
                transformsData.bombos[id] = transform;
            }

            // Enviar al servidor
            socket.emit('update_transform', { type, id, transform });
            console.log(`Transform updated for ${type} ${id}:`, transform);
        }

        // Actualizar configuraci√≥n de banderas de bombos
        function updateBomboFlagsConfig() {
            const offsetX = parseFloat(document.getElementById('flags-offsetX').value) || 0;
            const offsetY = parseFloat(document.getElementById('flags-offsetY').value) || 0;
            const columnSpacing = parseFloat(document.getElementById('flags-columnSpacing').value) || 155;
            const rowSpacing = parseFloat(document.getElementById('flags-rowSpacing').value) || 45;
            const width = parseFloat(document.getElementById('flags-width').value) || 48;
            const height = parseFloat(document.getElementById('flags-height').value) || 32;
            
            bomboFlagsConfig = { offsetX, offsetY, columnSpacing, rowSpacing, width, height };
            
            // Enviar al servidor
            socket.emit('update_bombo_flags_config', bomboFlagsConfig);
            console.log('Bombo flags config updated:', bomboFlagsConfig);
        }
        
        // Actualizar configuraci√≥n del resplandor
        function updateGlowConfig() {
            const x = parseFloat(document.getElementById('glow-x').value) || 960;
            const y = parseFloat(document.getElementById('glow-y').value) || 540;
            const width = parseFloat(document.getElementById('glow-width').value) || 600;
            const height = parseFloat(document.getElementById('glow-height').value) || 400;
            
            glowConfig = { x, y, width, height };
            
            // Enviar al servidor
            socket.emit('update_glow_config', glowConfig);
            console.log('Glow config updated:', glowConfig);
        }
        
        // Recibir actualizaciones de configuraci√≥n de banderas desde el servidor
        socket.on('bombo_flags_config_update', (config) => {
            console.log('Bombo flags config update received from server');
            bomboFlagsConfig = config;
            // Si el panel est√° abierto, regenerar controles con nuevos valores
            if (document.getElementById('transformsModal').style.display === 'flex') {
                generateTransformControls();
            }
        });
        
        // Recibir actualizaciones de configuraci√≥n del resplandor desde el servidor
        socket.on('glow_config_update', (config) => {
            console.log('Glow config update received from server');
            glowConfig = config;
            // Si el panel est√° abierto, regenerar controles con nuevos valores
            if (document.getElementById('transformsModal').style.display === 'flex') {
                generateTransformControls();
            }
        });

        // Recibir actualizaciones de transformaciones desde el servidor
        socket.on('transforms_update', (data) => {
            console.log('Transforms update received from server');
            transformsData = data;
            // Si el panel est√° abierto, regenerar controles con nuevos valores
            if (document.getElementById('transformsModal').style.display === 'flex') {
                generateTransformControls();
            }
        });

        // Cerrar panel de transformaciones al hacer clic fuera
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('transformsModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('transformsModal')) {
                    closeTransformsPanel();
                }
            });
        });

        // Inicializar la p√°gina
        render();
        renderBomboGrid(1);
    </script>
</body>
</html>
