<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Overlay 3 - Disposición Vertical (3×4)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    @font-face {
      font-family: 'Moderniz';
      src: url('/fuente/Moderniz.otf') format('opentype');
    }

    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: transparent;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    svg {
      display: block;
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      position: relative;
      z-index: 5; /* Por encima del resplandor (z-index: 2) */
      aspect-ratio: 16 / 9;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }
    svg.loaded {
      opacity: 1;
    }
    @supports not (aspect-ratio: 16 / 9) {
      svg {
        width: 100vw;
        height: 56.25vw;
        max-height: 100vh;
        max-width: 177.78vh;
      }
    }

    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    }
    #loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    image.assigned-flag {
      filter: grayscale(100%) opacity(0.5);
    }

    .assigned-text {
      fill: #888888 !important;
      opacity: 0.5;
    }

    /* Animación de fade para cambio entre bombos */
    .bombo-container {
      transition: opacity 0.4s ease-in-out;
    }
    .team-item.incoming-team {
        animation: teamPop 0.8s ease-out;
    }

    @keyframes teamPop {
        0% {
            transform: scale(0.2);
            opacity: 0;
        }
        60% {
            transform: scale(1.15);
            opacity: 1;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    
    .bombo-container.fade-out {
      opacity: 0;
    }
    
    .bombo-container.fade-in {
      opacity: 1;
    }
    /* Chip flotante que "vuela" hasta el grupo */
    .flying-team {
        position: fixed;
        z-index: 9999;
        padding: 8px 16px;
        border-radius: 999px;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        color: #000;
        font-weight: 700;
        font-family: 'Poppins', sans-serif;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.85);
        pointer-events: none;
        transform: translate(-50%, -50%);
        transition: left 0.7s ease-out, top 0.7s ease-out, opacity 0.3s ease-out;
    }

    /* Slot del grupo al que acaba de llegar el equipo */
    .team-item.just-arrived {
        background: rgba(255, 215, 0, 0.25);
        color: #ffffff;
        font-weight: 700;
        transform: scale(1.05);
        transition: background 0.3s ease, transform 0.3s ease;
    }


    .loading-text {
      color: #fff;
      font-family: 'Moderniz', Arial, sans-serif;
      font-size: 24px;
      margin-bottom: 20px;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-progress {
      color: #fff;
      font-family: 'Moderniz', Arial, sans-serif;
      font-size: 16px;
      margin-top: 20px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-30px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .flag-image {
      width: 51.4px;
      height: 34.2px;
    }
    image[id^="flag"] {
      border-radius: 12.51px;
    }
    
    /* Capa de fondo separada del SVG */
    #background-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #background-layer img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
      max-width: 177.78vh;
      max-height: 100vh;
    }
    
    #bg-lines {
      transition: opacity 0.6s ease;
    }
    
    /* Capa frontal con títulos y textos (z-index: 3) */
    #foreground-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #foreground-layer img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
      max-width: 177.78vh;
      max-height: 100vh;
    }
    
    /* Capas de imágenes especiales - aparecen cuando se destaca el país (z-index: 10) */
    .special-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    
    .special-layer.visible {
      opacity: 1;
    }
    
    .special-layer img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
      max-width: 177.78vh;
      max-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="loading-text">Cargando transmisión...</div>
    <div class="loading-spinner"></div>
    <div class="loading-progress" id="loading-progress">0%</div>
  </div>
  <!-- Bandera que se usa para la animación de viaje del bombo al grupo -->
  <img id="flying-flag" src="/w2560/inc.png" alt="" />
  
  <!-- Capa de fondo (z-index: 1) -->
  <div id="background-layer">
    <img id="bg-fondo" src="/w2560/fondo.png" alt="" />
    <img id="bg-lines" src="/w2560/fondolineasbombos.png" alt="" />
  </div>
  
  <!-- Resplandor de colores de bandera (z-index: 2) -->
  <div id="country-glow" class="country-glow"></div>
  
  <!-- Capa frontal con títulos y textos (z-index: 3) -->
  <div id="foreground-layer">
    <img id="fg-frente" src="/w2560/frente.png" alt="" />
  </div>
  
  <!-- Capas especiales - aparecen cuando se destaca el país correspondiente (z-index: 10) -->
  <div id="eu1-layer" class="special-layer">
    <img src="/w2560/EU1.png" alt="" />
  </div>
  <div id="eu2-layer" class="special-layer">
    <img src="/w2560/EU2.png" alt="" />
  </div>
  <div id="eu3-layer" class="special-layer">
    <img src="/w2560/EU3.png" alt="" />
  </div>
  <div id="eu4-layer" class="special-layer">
    <img src="/w2560/EU4.png" alt="" />
  </div>
  <div id="int1-layer" class="special-layer">
    <img src="/w2560/INT1.png" alt="" />
  </div>
  <div id="in2-layer" class="special-layer">
    <img src="/w2560/IN2.png" alt="" />
  </div>
  
  <!-- Contenedor de banderas de bombos en CSS -->
  <div id="bombo-flags-container"></div>
  
  <!-- Texto del nombre del país destacado -->
  <div id="featured-country-name" class="featured-country-name"></div>
  
  <!-- Contenedor de banderas y textos de grupos en CSS -->
  <div id="groups-flags-container"></div>
  
  <svg id="Capa_1" data-name="Capa 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1920 1080">
    <defs id="svg-defs">
      <style>
        .cls-7 { font-size: 14px; fill: #fff; transition: opacity 0.4s ease; }
        .cls-7, .cls-8 { font-family: 'Moderniz', Arial, sans-serif; }
        .cls-17 { fill: transparent; }
        
        /* Slots de grupos ocultos por defecto */
        image[id^="flag"]:not([id^="flag-container"]):not([id*="bombo"]) {
          transition: opacity 0.4s ease;
        }
        .cls-20 { letter-spacing: -.03em; }

        /* ANTES ESTABA: .cls-22, .cls-8 { fill: none; } */
        .cls-22 { fill: none; }

        .cls-23 { letter-spacing: -.06em; }
        .cls-43 { letter-spacing: -.18em; }

        /* AHORA LE DAMOS COLOR A TODO LO QUE USE cls-8 (BOMBO 1,2,3,4, "Grupo A", etc.) */
        .cls-8 { font-size: 16.05px; fill: #fff; }

        .cls-56 { fill: none; stroke: none; stroke-miterlimit: 10; }
        .cls-57 { letter-spacing: -.11em; }
        /* Bandera que vuela del bombo al grupo */
        #flying-flag {
          position: fixed;
          z-index: 9998;
          pointer-events: none;
          display: none;
          opacity: 0;
          transition:
            left 0.5s ease-out,
            top 0.5s ease-out,
            width 0.5s ease-out,
            height 0.5s ease-out,
            opacity 0.2s ease-out;
          border-radius: 12px;
        }


        /* Transiciones suaves para animación de país destacado */
        text[id^="bombo-team-"], g[id^="flag-container-"] {
          transition: opacity 0.3s ease;
        }
        
        /* Transición suave para animación de bandera destacada */
        g[id^="flag-container-"] {
          transition: transform 0.6s ease, opacity 0.3s ease;
          transform-origin: center center;
        }
        
        image[id^="bombo-flag-"] {
          transition: transform 0.6s ease;
          transform-origin: center center;
        }
        
        /* Contenedor de banderas en CSS */
        #bombo-flags-container {
          position: absolute;
          top: 0;
          left: 0;
          width: 1920px;
          height: 1080px;
          pointer-events: none;
          z-index: 100;
        }
        
        .bombo-flag-css {
          position: absolute;
          width: 48px;
          height: 32px;
          border-radius: 12px;
          object-fit: cover;
          transition: all 0.6s ease;
          transform-origin: center center;
          z-index: 50;
        }
        
        .bombo-flag-css.highlighted {
          z-index: 100;
        }
        
        .bombo-flag-css.assigned {
          filter: grayscale(100%);
          opacity: 0.6;
        }
        
        .bombo-flag-css.dimmed {
          opacity: 0 !important;
        }
        
        /* Texto del nombre del país destacado */
        .featured-country-name {
          position: fixed;
          font-family: 'Moderniz', Arial, sans-serif;
          font-size: 24px;
          font-weight: bold;
          color: #ffffff;
          text-align: center;
          text-transform: uppercase;
          text-shadow: 
            2px 2px 4px rgba(0, 0, 0, 0.9),
            0 0 10px rgba(0, 0, 0, 0.5);
          opacity: 0;
          transition: opacity 0.5s ease;
          z-index: 9999;
          pointer-events: none;
          white-space: nowrap;
        }
        
        /* Animación de respiración para el glow */
        @keyframes glow-breathing {
          0%, 100% {
            transform: scale(1.07);
            filter: blur(15px) brightness(1);
          }
          50% {
            transform: scale(1.08);
            filter: blur(20px) brightness(1.15);
          }
        }
        
        /* Resplandor rectangular con franjas de colores de bandera */
        .country-glow {
          position: fixed;
          pointer-events: none;
          opacity: 0;
          /* Animación suave de fade in/out */
          transition: opacity 0.5s ease-in-out;
          z-index: 2; /* Por debajo de grupos (z-index: 5) */

          /* El JS le pone el gradient con los colores del borde */
          background: transparent;

          /* Un poco redondeado para que el halo sea suave */
          border-radius: 0px;

          /* Acá vuelve el halo difuso que respeta el gradiente */
          filter: blur(20px);

          /* Opcional, hace que el resplandor se mezcle lindo con el fondo */
          mix-blend-mode: screen;
          
          /* Transform origin para que escale desde el centro */
          transform-origin: center center;
        }
        
        /* Clase activa con efecto de respiración */
        .country-glow.breathing {
          animation: glow-breathing 2.5s ease-in-out infinite;
        }
        
        /* Contenedor de banderas y textos de grupos en CSS (deshabilitado, usamos SVG) */
        #groups-flags-container {
          display: none;
        }
        
        .group-slot {
          position: absolute;
          display: flex;
          align-items: center;
          gap: 10px;
          opacity: 0;
          transition: opacity 0.4s ease;
        }
        
        .group-slot.visible {
          opacity: 1;
        }
        
        .group-flag-css {
          width: 51.4px;
          height: 34.2px;
          border-radius: 12px;
          object-fit: cover;
        }
        
        .group-team-name {
          font-family: 'Moderniz', Arial, sans-serif;
          font-size: 14px;
          color: #ffffff;
          white-space: nowrap;
          transition: opacity 0.4s ease;
        }
        
        .group-team-name.placeholder {
          color: #666666;
          font-style: italic;
        }
        
        .group-flag-css.white-border {
          border: 2px solid #555555;
        }
        
        @keyframes text-sweep-in {
          from {
            clip-path: inset(0 100% 0 0);
          }
          to {
            clip-path: inset(0 0 0 0);
          }
        }
        
        .team-name-animate {
          animation: text-sweep-in 0.8s ease-in-out forwards;
        }

      </style>
      
      <!-- ClipPaths para bordes redondeados de banderas -->
      <clipPath id="flag-rounded-bombo" clipPathUnits="userSpaceOnUse">
        <rect x="0" y="0" width="48" height="32" rx="12" ry="8"/>
      </clipPath>
      <clipPath id="flag-rounded-groups" clipPathUnits="userSpaceOnUse">
        <rect x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3"/>
      </clipPath>
      <clipPath id="flag-rounded-featured" clipPathUnits="userSpaceOnUse">
        <rect x="0" y="0" width="120" height="80" rx="15" ry="10"/>
      </clipPath>
    </defs>

    <!-- Imagen de fondo escalada de 3840x2160 a 1920x1080 -->
    <!-- Fondos movidos a #background-layer HTML para control de z-index -->
    <!-- <image id="background-image" x="0" y="0" width="1920" height="1080" href="/w2560/fondo.png" preserveAspectRatio="xMidYMid slice"/>
    <image id="background-lines-bombos" x="0" y="0" width="1920" height="1080" href="/w2560/fondolineasbombos.png" opacity="1" preserveAspectRatio="xMidYMid slice" style="transition: opacity 0.6s ease;"/> -->

    <rect class="cls-17" width="1920" height="1080"/>
    <!-- Bombo 1 -->
    <g id="bombo-container-1" class="bombo-container" opacity="1">
      <path class="cls-22" d="M194.58,254.73h474.83v169.3c0,20.51-16.65,37.16-37.16,37.16H194.58v-206.47h0Z" fill="#e8e8e8"/>
      <path d="M232.7,216.61h398.58c21.04,0,38.12,17.08,38.12,38.12H194.58c0-21.04,17.08-38.12,38.12-38.12Z" fill="none"/>
      <text class="cls-8" id="bombo-title-1" transform="translate(378 240)"><tspan x="0" y="0">BOMBO 1</tspan></text>
      
      <!-- Columna 1 -->
      <rect id="country-highlight-0" x="217" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-0" transform="translate(277 290)" style="fill: #fff;"></text>
      <rect id="country-highlight-1" x="217" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-1" transform="translate(277 335)" style="fill: #fff;"></text>
      <rect id="country-highlight-2" x="217" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-2" transform="translate(277 381)" style="fill: #fff;"></text>
      <rect id="country-highlight-3" x="217" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-3" transform="translate(277 433)" style="fill: #fff;"></text>
      
      <!-- Columna 2 -->
      <rect id="country-highlight-4" x="372" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-4" transform="translate(432 290)" style="fill: #fff;"></text>
      <rect id="country-highlight-5" x="372" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-5" transform="translate(432 335)" style="fill: #fff;"></text>
      <rect id="country-highlight-6" x="372" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-6" transform="translate(432 381)" style="fill: #fff;"></text>
      <rect id="country-highlight-7" x="372" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-7" transform="translate(432 433)" style="fill: #fff;"></text>
      
      <!-- Columna 3 -->
      <rect id="country-highlight-8" x="527" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-8" transform="translate(587 290)" style="fill: #fff;"></text>
      <rect id="country-highlight-9" x="527" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-9" transform="translate(587 335)" style="fill: #fff;"></text>
      <rect id="country-highlight-10" x="527" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-10" transform="translate(587 381)" style="fill: #fff;"></text>
      <rect id="country-highlight-11" x="527" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-11" transform="translate(587 433)" style="fill: #fff;"></text>
    </g>
    

    <!-- Bombo 2 -->
    <g id="bombo-container-2" class="bombo-container" opacity="1" style="display:none;">
      <path class="cls-22" d="M194.58,254.73h474.83v169.3c0,20.51-16.65,37.16-37.16,37.16H194.58v-206.47h0Z" fill="#e8e8e8"/>
      <path d="M232.7,216.61h398.58c21.04,0,38.12,17.08,38.12,38.12H194.58c0-21.04,17.08-38.12,38.12-38.12Z" fill="none"/>
      <text class="cls-8" id="bombo-title-2" transform="translate(378 240)"><tspan x="0" y="0">BOMBO 2</tspan></text>

      <rect id="country-highlight-0-b2" x="217" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-0-b2" transform="translate(277 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-1-b2" x="217" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-1-b2" transform="translate(277 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-2-b2" x="217" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-2-b2" transform="translate(277 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-3-b2" x="217" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-3-b2" transform="translate(277 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-4-b2" x="372" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-4-b2" transform="translate(432 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-5-b2" x="372" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-5-b2" transform="translate(432 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-6-b2" x="372" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-6-b2" transform="translate(432 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-7-b2" x="372" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-7-b2" transform="translate(432 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-8-b2" x="527" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-8-b2" transform="translate(587 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-9-b2" x="527" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-9-b2" transform="translate(587 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-10-b2" x="527" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-10-b2" transform="translate(587 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-11-b2" x="527" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-11-b2" transform="translate(587 433)" style="fill: #fff;"></text>
    </g>

    <!-- Bombo 3 -->
    <g id="bombo-container-3" class="bombo-container" opacity="1" style="display:none;">
      <path class="cls-22" d="M194.58,254.73h474.83v169.3c0,20.51-16.65,37.16-37.16,37.16H194.58v-206.47h0Z" fill="#e8e8e8"/>
      <path d="M232.7,216.61h398.58c21.04,0,38.12,17.08,38.12,38.12H194.58c0-21.04,17.08-38.12,38.12-38.12Z" fill="none"/>
      <text class="cls-8" id="bombo-title-3" transform="translate(378 240)"><tspan x="0" y="0">BOMBO 3</tspan></text>

      <rect id="country-highlight-0-b3" x="217" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-0-b3" transform="translate(277 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-1-b3" x="217" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-1-b3" transform="translate(277 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-2-b3" x="217" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-2-b3" transform="translate(277 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-3-b3" x="217" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-3-b3" transform="translate(277 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-4-b3" x="372" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-4-b3" transform="translate(432 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-5-b3" x="372" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-5-b3" transform="translate(432 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-6-b3" x="372" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-6-b3" transform="translate(432 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-7-b3" x="372" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-7-b3" transform="translate(432 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-8-b3" x="527" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-8-b3" transform="translate(587 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-9-b3" x="527" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-9-b3" transform="translate(587 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-10-b3" x="527" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-10-b3" transform="translate(587 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-11-b3" x="527" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-11-b3" transform="translate(587 433)" style="fill: #fff;"></text>
    </g>

    <!-- Bombo 4 -->
    <g id="bombo-container-4" class="bombo-container" opacity="1" style="display:none;">
      <path class="cls-22" d="M194.58,254.73h474.83v169.3c0,20.51-16.65,37.16-37.16,37.16H194.58v-206.47h0Z" fill="#e8e8e8"/>
      <path d="M232.7,216.61h398.58c21.04,0,38.12,17.08,38.12,38.12H194.58c0-21.04,17.08-38.12,38.12-38.12Z" fill="none"/>
      <text class="cls-8" id="bombo-title-4" transform="translate(378 240)"><tspan x="0" y="0">BOMBO 4</tspan></text>

      <rect id="country-highlight-0-b4" x="217" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-0-b4" transform="translate(277 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-1-b4" x="217" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-1-b4" transform="translate(277 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-2-b4" x="217" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-2-b4" transform="translate(277 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-3-b4" x="217" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-3-b4" transform="translate(277 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-4-b4" x="372" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-4-b4" transform="translate(432 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-5-b4" x="372" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-5-b4" transform="translate(432 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-6-b4" x="372" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-6-b4" transform="translate(432 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-7-b4" x="372" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-7-b4" transform="translate(432 433)" style="fill: #fff;"></text>

      <rect id="country-highlight-8-b4" x="527" y="270" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-8-b4" transform="translate(587 290)" style="fill: #fff;"></text>

      <rect id="country-highlight-9-b4" x="527" y="312" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-9-b4" transform="translate(587 335)" style="fill: #fff;"></text>

      <rect id="country-highlight-10-b4" x="527" y="354" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-10-b4" transform="translate(587 381)" style="fill: #fff;"></text>

      <rect id="country-highlight-11-b4" x="527" y="396" width="115" height="42" rx="8" ry="8" fill="#AA8112" opacity="0" style="transition: opacity 0.3s;"/>
      <text class="cls-8" id="bombo-team-11-b4" transform="translate(587 433)" style="fill: #fff;"></text>
    </g>

    <g><path class="cls-22" d="M194.58,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerA" d="M232.7,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(263.7 561.54)"><tspan></tspan></text><g transform="translate(210.63 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagA1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagA1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="A1" transform="translate(272.65 613.48)">Pais 1</text><g transform="translate(210.63 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagA2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagA2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="A2" transform="translate(272.65 658.46)">Pais 2</text><g transform="translate(210.63 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagA3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagA3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="A3" transform="translate(272.65 703.44)">Pais 3</text><g transform="translate(210.63 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagA4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagA4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="A4" transform="translate(272.65 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M455.44,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerB" d="M493.56,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(521.84 561.54)"><tspan></tspan></text><g transform="translate(471.49 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagB1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagB1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="B1" transform="translate(533.51 613.48)">Pais 1</text><g transform="translate(471.49 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagB2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagB2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="B2" transform="translate(533.51 658.46)">Pais 2</text><g transform="translate(471.49 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagB3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagB3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="B3" transform="translate(533.51 703.44)">Pais 3</text><g transform="translate(471.49 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagB4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagB4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="B4" transform="translate(533.51 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M716.3,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerC" d="M754.42,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(782.55 561.54)"><tspan></tspan></text><g transform="translate(732.35 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagC1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagC1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="C1" transform="translate(794.37 613.48)">Pais 1</text><g transform="translate(732.35 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagC2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagC2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="C2" transform="translate(794.37 658.46)">Pais 2</text><g transform="translate(732.35 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagC3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagC3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="C3" transform="translate(794.37 703.44)">Pais 3</text><g transform="translate(732.35 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagC4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagC4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="C4" transform="translate(794.37 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M977.16,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerD" d="M1015.28,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1043.22 561.54)"><tspan></tspan></text><g transform="translate(993.21 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagD1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagD1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="D1" transform="translate(1055.23 613.48)">Pais 1</text><g transform="translate(993.21 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagD2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagD2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="D2" transform="translate(1055.23 658.46)">Pais 2</text><g transform="translate(993.21 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagD3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagD3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="D3" transform="translate(1055.23 703.44)">Pais 3</text><g transform="translate(993.21 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagD4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagD4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="D4" transform="translate(1055.23 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M1238.02,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerE" d="M1276.14,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1304.4 561.54)"><tspan></tspan></text><g transform="translate(1254.07 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagE1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagE1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="E1" transform="translate(1316.09 613.48)">Pais 1</text><g transform="translate(1254.07 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagE2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagE2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="E2" transform="translate(1316.09 658.46)">Pais 2</text><g transform="translate(1254.07 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagE3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagE3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="E3" transform="translate(1316.09 703.44)">Pais 3</text><g transform="translate(1254.07 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagE4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagE4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="E4" transform="translate(1316.09 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M1498.88,573.87h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerF" d="M1537,535.74h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1565.12 561.54)"><tspan></tspan></text><g transform="translate(1514.93 591.27)" clip-path="url(#flag-rounded-groups)"><image id="flagF1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagF1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="F1" transform="translate(1576.95 613.48)">Pais 1</text><g transform="translate(1514.93 636.25)" clip-path="url(#flag-rounded-groups)"><image id="flagF2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagF2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="F2" transform="translate(1576.95 658.46)">Pais 2</text><g transform="translate(1514.93 681.23)" clip-path="url(#flag-rounded-groups)"><image id="flagF3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagF3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="F3" transform="translate(1576.95 703.44)">Pais 3</text><g transform="translate(1514.93 726.2)" clip-path="url(#flag-rounded-groups)"><image id="flagF4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagF4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="F4" transform="translate(1576.95 748.41)">Pais 4</text></g>
    <g><path class="cls-22" d="M194.58,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerG" d="M232.7,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(261.87 826.74)"><tspan></tspan></text><g transform="translate(210.63 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagG1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagG1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="G1" transform="translate(272.65 878.68)">Pais 1</text><g transform="translate(210.63 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagG2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagG2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="G2" transform="translate(272.65 923.65)">Pais 2</text><g transform="translate(210.63 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagG3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagG3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="G3" transform="translate(272.65 968.63)">Pais 3</text><g transform="translate(210.63 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagG4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagG4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="G4" transform="translate(272.65 1013.61)">Pais 4</text></g>
    <g><path class="cls-22" d="M455.44,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerH" d="M493.56,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(521.44 826.74)"><tspan></tspan></text><g transform="translate(471.49 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagH1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagH1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="H1" transform="translate(533.51 878.68)">Pais 1</text><g transform="translate(471.49 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagH2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagH2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="H2" transform="translate(533.51 923.65)">Pais 2</text><g transform="translate(471.49 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagH3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagH3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="H3" transform="translate(533.51 968.63)">Pais 3</text><g transform="translate(471.49 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagH4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagH4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="H4" transform="translate(533.51 1013.61)">Pais 4</text></g>
    <g><path class="cls-22" d="M716.3,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerI" d="M754.42,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(782.54 826.74)"><tspan></tspan></text><g transform="translate(732.35 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagI1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagI1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="I1" transform="translate(794.37 878.68)">Pais 1</text><g transform="translate(732.35 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagI2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagI2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="I2" transform="translate(794.37 923.65)">Pais 2</text><g transform="translate(732.35 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagI3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagI3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="I3" transform="translate(794.37 968.63)">Pais 3</text><g transform="translate(732.35 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagI4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagI4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="I4" transform="translate(794.37 1013.61)">Pais 4</text></g>
    <g><path class="cls-22" d="M977.16,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerJ" d="M1015.28,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1043.22 826.74)"><tspan></tspan></text><g transform="translate(993.21 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagJ1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagJ1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="J1" transform="translate(1055.23 878.68)">Pais 1</text><g transform="translate(993.21 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagJ2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagJ2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="J2" transform="translate(1055.23 923.65)">Pais 2</text><g transform="translate(993.21 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagJ3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagJ3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="J3" transform="translate(1055.23 968.63)">Pais 3</text><g transform="translate(993.21 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagJ4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagJ4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="J4" transform="translate(1055.23 1013.61)">Pais 4</text></g>
    <g><path class="cls-22" d="M1238.02,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerK" d="M1276.14,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1304.4 826.74)"><tspan></tspan></text><g transform="translate(1254.07 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagK1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagK1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="K1" transform="translate(1316.09 878.68)">Pais 1</text><g transform="translate(1254.07 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagK2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagK2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="K2" transform="translate(1316.09 923.65)">Pais 2</text><g transform="translate(1254.07 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagK3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagK3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="K3" transform="translate(1316.09 968.63)">Pais 3</text><g transform="translate(1254.07 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagK4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagK4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="K4" transform="translate(1316.09 1013.61)">Pais 4</text></g>
    <g><path class="cls-22" d="M1498.88,839.06h233.45v169.3c0,20.51-16.65,37.16-37.16,37.16h-196.29v-206.47h0Z"/><path id="headerL" d="M1537,800.94h157.21c21.04,0,38.12,17.08,38.12,38.12h-233.45c0-21.04,17.08-38.12,38.12-38.12Z" fill="#fff"/><text class="cls-8" transform="translate(1560.92 826.74)"><tspan></tspan></text><g transform="translate(1514.93 856.47)" clip-path="url(#flag-rounded-groups)"><image id="flagL1" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagL1" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="L1" transform="translate(1576.95 878.68)">Pais 1</text><g transform="translate(1514.93 901.44)" clip-path="url(#flag-rounded-groups)"><image id="flagL2" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagL2" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="L2" transform="translate(1576.95 923.65)">Pais 2</text><g transform="translate(1514.93 946.42)" clip-path="url(#flag-rounded-groups)"><image id="flagL3" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagL3" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="L3" transform="translate(1576.95 968.63)">Pais 3</text><g transform="translate(1514.93 991.4)" clip-path="url(#flag-rounded-groups)"><image id="flagL4" x="0" y="0" width="51.4" height="34.2" href=""/><rect id="border-flagL4" x="0" y="0" width="51.4" height="34.2" rx="12.51" ry="8.3" fill="none" stroke="none" stroke-width="2"/></g><text class="cls-7" id="L4" transform="translate(1576.95 1013.61)">Pais 4</text></g>
  </svg>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const countryToCode = {
      "Alemania": "de", "A. Saudita": "sa", "Argelia": "dz", "Argentina": "ar", "Australia": "au",
      "Austria": "at", "Bélgica": "be", "Brasil": "br", "Cabo Verde": "cv", "Canadá": "ca",
      "Catar": "qa", "Colombia": "co", "Costa de Marfil": "ci", "Croacia": "hr", "Curazao": "cw",
      "Ecuador": "ec", "Egipto": "eg", "Escocia": "gb-sct", "España": "es", "Estados Unidos": "us",
      "Francia": "fr", "Ghana": "gh", "Haití": "ht", "Inglaterra": "gb-eng", "Irán": "ir",
      "Japón": "jp", "Jordania": "jo", "Marruecos": "ma", "México": "mx", "Noruega": "no",
      "Nueva Zelanda": "nz", "Holanda": "nl", "Países Bajos": "nl", "Panamá": "pa", "Paraguay": "py", "Portugal": "pt",
      "República de Corea": "kr", "Senegal": "sn", "Sudáfrica": "za", "Suiza": "ch", "Túnez": "tn",
      "Uruguay": "uy", "Uzbekistán": "uz", "Corea del Sur": "kr",
      "R. EUROPA 1": "uefa", "R. EUROPA 2": "uefa", "R. EUROPA 3": "uefa", "R. EUROPA 4": "uefa",
      "R. INTERCONT 1": "fifa", "R. INTERCONT 2": "fifa",
      "Repechaje Europeo 1": "uefa", "Repechaje Europeo 2": "uefa", "Repechaje Europeo 3": "uefa", "Repechaje Europeo 4": "uefa",
      "Repechaje Intercontinental 1": "fifa", "Repechaje Intercontinental 2": "fifa"
    };

    // Colores del BORDE EXTERIOR de cada bandera
    // top/bottom: gradiente horizontal (izq a der), left/right: gradiente vertical (arriba a abajo)
    // Cada borde define los colores que aparecen en ese lado del perímetro real de la bandera
    const countryFlagData = {
      // Franjas horizontales: top y bottom son colores sólidos, left y right muestran las franjas
      "Alemania": { top: ["#000000"], bottom: ["#FFCC00"], left: ["#000000", "#DD0000", "#FFCC00"], right: ["#000000", "#DD0000", "#FFCC00"] },
      "A. Saudita": { top: ["#006C35"], bottom: ["#006C35"], left: ["#006C35"], right: ["#006C35"] },
      "Argelia": { top: ["#006233", "#FFFFFF"], bottom: ["#006233", "#FFFFFF"], left: ["#006233"], right: ["#FFFFFF"] },
      "Argentina": { top: ["#74ACDF"], bottom: ["#74ACDF"], left: ["#74ACDF", "#FFFFFF", "#74ACDF"], right: ["#74ACDF", "#FFFFFF", "#74ACDF"] },
      "Australia": { top: ["#00008B"], bottom: ["#00008B"], left: ["#00008B"], right: ["#00008B"] },
      "Austria": { top: ["#ED2939"], bottom: ["#ED2939"], left: ["#ED2939", "#FFFFFF", "#ED2939"], right: ["#ED2939", "#FFFFFF", "#ED2939"] },
      "Bélgica": { top: ["#000000", "#FAE042", "#ED2939"], bottom: ["#000000", "#FAE042", "#ED2939"], left: ["#000000"], right: ["#ED2939"] },
      "Brasil": { top: ["#009C3B"], bottom: ["#009C3B"], left: ["#009C3B"], right: ["#009C3B"] },
      "Cabo Verde": { top: ["#003893"], bottom: ["#003893"], left: ["#003893"], right: ["#003893"] },
      "Canadá": { top: ["#FF0000", "#FFFFFF", "#FF0000"], bottom: ["#FF0000", "#FFFFFF", "#FF0000"], left: ["#FF0000"], right: ["#FF0000"] },
      "Catar": { top: ["#FFFFFF", "#8A1538"], bottom: ["#FFFFFF", "#8A1538"], left: ["#FFFFFF"], right: ["#8A1538"] },
      "Colombia": { top: ["#FCD116"], bottom: ["#CE1126"], left: ["#FCD116", "#003893", "#CE1126"], right: ["#FCD116", "#003893", "#CE1126"], leftStops: [50, 75, 100], rightStops: [50, 75, 100] },
      "Costa de Marfil": { top: ["#FF8200", "#FFFFFF", "#009E60"], bottom: ["#FF8200", "#FFFFFF", "#009E60"], left: ["#FF8200"], right: ["#009E60"] },
      "Croacia": { top: ["#FF0000"], bottom: ["#171796"], left: ["#FF0000", "#FFFFFF", "#171796"], right: ["#FF0000", "#FFFFFF", "#171796"] },
      "Curazao": { top: ["#002B7F"], bottom: ["#002B7F"], left: ["#002B7F"], right: ["#002B7F"] },
      "Ecuador": { top: ["#FFD100"], bottom: ["#EF3340"], left: ["#FFD100", "#0033A0", "#EF3340"], right: ["#FFD100", "#0033A0", "#EF3340"], leftStops: [50, 75, 100], rightStops: [50, 75, 100] },
      "Egipto": { top: ["#CE1126"], bottom: ["#000000"], left: ["#CE1126", "#FFFFFF", "#000000"], right: ["#CE1126", "#FFFFFF", "#000000"] },
      "Escocia": { top: ["#005EB8"], bottom: ["#005EB8"], left: ["#005EB8"], right: ["#005EB8"] },
      "España": { top: ["#AA151B"], bottom: ["#AA151B"], left: ["#AA151B", "#F1BF00", "#AA151B"], right: ["#AA151B", "#F1BF00", "#AA151B"], leftStops: [25, 75, 100], rightStops: [25, 75, 100] },
      "Estados Unidos": { top: ["#002868", "#BF0A30"], bottom: ["#BF0A30", "#FFFFFF"], left: ["#002868", "#BF0A30", "#FFFFFF"], right: ["#BF0A30", "#FFFFFF", "#BF0A30"] },
      "Francia": { top: ["#002395", "#FFFFFF", "#ED2939"], bottom: ["#002395", "#FFFFFF", "#ED2939"], left: ["#002395"], right: ["#ED2939"] },
      "Ghana": { top: ["#EF3340"], bottom: ["#006B3F"], left: ["#EF3340", "#FCD116", "#006B3F"], right: ["#EF3340", "#FCD116", "#006B3F"] },
      "Haití": { top: ["#00209F"], bottom: ["#D21034"], left: ["#00209F", "#D21034"], right: ["#00209F", "#D21034"] },
      "Inglaterra": { top: ["#FFFFFF", "#CE1124", "#FFFFFF"], bottom: ["#FFFFFF", "#CE1124", "#FFFFFF"], left: ["#FFFFFF"], right: ["#FFFFFF"] },
      "Irán": { top: ["#239F40"], bottom: ["#DA0000"], left: ["#239F40", "#FFFFFF", "#DA0000"], right: ["#239F40", "#FFFFFF", "#DA0000"] },
      "Japón": { top: ["#FFFFFF"], bottom: ["#FFFFFF"], left: ["#FFFFFF"], right: ["#FFFFFF"] },
      "Jordania": { top: ["#000000"], bottom: ["#007A3D"], left: ["#CE1126", "#000000", "#FFFFFF", "#007A3D"], right: ["#000000", "#FFFFFF", "#007A3D"] },
      "Marruecos": { top: ["#C1272D"], bottom: ["#C1272D"], left: ["#C1272D"], right: ["#C1272D"] },
      "México": { top: ["#006847", "#FFFFFF", "#CE1126"], bottom: ["#006847", "#FFFFFF", "#CE1126"], left: ["#006847"], right: ["#CE1126"] },
      "Noruega": { top: ["#EF2B2D"], bottom: ["#EF2B2D"], left: ["#EF2B2D", "#FFFFFF", "#002868", "#FFFFFF", "#EF2B2D"], right: ["#EF2B2D", "#FFFFFF", "#002868", "#FFFFFF", "#EF2B2D"] },
      "Nueva Zelanda": { top: ["#00247D"], bottom: ["#00247D"], left: ["#00247D"], right: ["#00247D"] },
      "Holanda": { top: ["#AE1C28"], bottom: ["#21468B"], left: ["#AE1C28", "#FFFFFF", "#21468B"], right: ["#AE1C28", "#FFFFFF", "#21468B"] },
      "Países Bajos": { top: ["#AE1C28"], bottom: ["#21468B"], left: ["#AE1C28", "#FFFFFF", "#21468B"], right: ["#AE1C28", "#FFFFFF", "#21468B"] },
      "Panamá": { top: ["#FFFFFF", "#DA121A"], bottom: ["#072357", "#FFFFFF"], left: ["#FFFFFF", "#072357"], right: ["#DA121A", "#FFFFFF"] },
      "Paraguay": { top: ["#D52B1E"], bottom: ["#0038A8"], left: ["#D52B1E", "#FFFFFF", "#0038A8"], right: ["#D52B1E", "#FFFFFF", "#0038A8"] },
      "Portugal": { top: ["#006600", "#FF0000"], bottom: ["#006600", "#FF0000"], left: ["#006600"], right: ["#FF0000"], topStops: [40, 100], bottomStops: [40, 100] },
      "República de Corea": { top: ["#FFFFFF"], bottom: ["#FFFFFF"], left: ["#FFFFFF"], right: ["#FFFFFF"] },
      "Senegal": { top: ["#00853F", "#FDEF42", "#E31B23"], bottom: ["#00853F", "#FDEF42", "#E31B23"], left: ["#00853F"], right: ["#E31B23"] },
      "Sudáfrica": { top: ["#DE3831"], bottom: ["#002395"], left: ["#DE3831", "#FFFFFF", "#007749", "#FFFFFF", "#002395"], right: ["#DE3831", "#FFFFFF", "#007749", "#FFFFFF", "#002395"] },
      "Suiza": { top: ["#FF0000", "#FFFFFF", "#FF0000"], bottom: ["#FF0000", "#FFFFFF", "#FF0000"], left: ["#FF0000"], right: ["#FF0000"] },
      "Túnez": { top: ["#E70013"], bottom: ["#E70013"], left: ["#E70013"], right: ["#E70013"] },
      "Uruguay": { top: ["#FFFFFF"], bottom: ["#0038A8"], left: ["#FFFFFF", "#0038A8", "#FFFFFF", "#0038A8"], right: ["#FFFFFF", "#0038A8", "#FFFFFF", "#0038A8"] },
      "Uzbekistán": { top: ["#0099B5"], bottom: ["#1EB53A"], left: ["#0099B5", "#FFFFFF", "#1EB53A"], right: ["#0099B5", "#FFFFFF", "#1EB53A"] },
      "Corea del Sur": { top: ["#FFFFFF"], bottom: ["#FFFFFF"], left: ["#FFFFFF"], right: ["#FFFFFF"] },
      "R. EUROPA 1": { top: ["#003399"], bottom: ["#003399"], left: ["#003399", "#FFD700", "#003399"], right: ["#003399", "#FFD700", "#003399"] },
      "R. EUROPA 2": { top: ["#003399"], bottom: ["#003399"], left: ["#003399", "#FFD700", "#003399"], right: ["#003399", "#FFD700", "#003399"] },
      "R. EUROPA 3": { top: ["#003399"], bottom: ["#003399"], left: ["#003399", "#FFD700", "#003399"], right: ["#003399", "#FFD700", "#003399"] },
      "R. EUROPA 4": { top: ["#003399"], bottom: ["#003399"], left: ["#003399", "#FFD700", "#003399"], right: ["#003399", "#FFD700", "#003399"] },
      "R. INTERCONT 1": { top: ["#326295"], bottom: ["#326295"], left: ["#326295"], right: ["#326295"] },
      "R. INTERCONT 2": { top: ["#326295"], bottom: ["#326295"], left: ["#326295"], right: ["#326295"] }
    };

    const bombos = {
      1: ["España", "Argentina", "Francia", "Inglaterra", "Brasil", "Portugal", "Holanda", "Bélgica", "Alemania", "Estados Unidos", "México", "Canadá"],
      2: ["Croacia", "Marruecos", "Colombia", "Uruguay", "Suiza", "Japón", "Senegal", "Irán", "República de Corea", "Ecuador", "Austria", "Australia"],
      3: ["Noruega", "Panamá", "Egipto", "Argelia", "Escocia", "Paraguay", "Túnez", "Costa de Marfil", "Uzbekistán", "Catar", "A. Saudita", "Sudáfrica"],
      4: ["Jordania", "Cabo Verde", "Ghana", "Curazao", "Haití", "Nueva Zelanda", "R. EUROPA 1", "R. EUROPA 2", "R. EUROPA 3", "R. EUROPA 4", "R. INTERCONT 1", "R. INTERCONT 2"]
    };

    // Offset para centrado de banderas del bombo
    const bomboFlagOffset = { x: -1, y: -1 };

    // Configuración del rectángulo dorado (highlight) en los bombos
    const HIGHLIGHT_COL_X_BASE = [217, 372, 527];
    const HIGHLIGHT_ROW_Y_BASE = [260, 306, 354, 396];
    const HIGHLIGHT_SIZE_BASE  = { width: 115, height: 42 };

    const HIGHLIGHT_FINE_OFFSET = {
      x: bomboFlagOffset.x,
      y: bomboFlagOffset.y,
      extraWidth: 0,
      extraHeight: 0
    };

    const HIGHLIGHT_COL_X = HIGHLIGHT_COL_X_BASE.map(x => x + HIGHLIGHT_FINE_OFFSET.x);
    const HIGHLIGHT_ROW_Y = HIGHLIGHT_ROW_Y_BASE.map(y => y + HIGHLIGHT_FINE_OFFSET.y);
    const HIGHLIGHT_WIDTH  = HIGHLIGHT_SIZE_BASE.width  + HIGHLIGHT_FINE_OFFSET.extraWidth;
    const HIGHLIGHT_HEIGHT = HIGHLIGHT_SIZE_BASE.height + HIGHLIGHT_FINE_OFFSET.extraHeight;

    // Alias de nombres para mostrar en grupos
    const countryDisplayAliases = {
      "República de Corea": "R. De Corea",
      "Estados Unidos": "EE.UU.",
      "Costa de Marfil": "C. De Marfil",
      "Nueva Zelanda": "N. Zelanda",
      "R. INTERCONT 1": "R. INTER 1",
      "R. INTERCONT 2": "R. INTER 2",
      "México": "Mexico",
      "Países Bajos": "Holanda"
    };

    const countryAbbreviations = {
      "España": "ESP", "Argentina": "ARG", "Francia": "FRA", "Inglaterra": "ENG", "Brasil": "BRA", "Portugal": "POR",
      "Holanda": "NED", "Países Bajos": "NED", "Bélgica": "BEL", "Alemania": "GER", "Estados Unidos": "USA", "México": "MEX", "Canadá": "CAN",
      "Croacia": "CRO", "Marruecos": "MAR", "Colombia": "COL", "Uruguay": "URU", "Suiza": "SUI", "Japón": "JPN",
      "Senegal": "SEN", "Irán": "IRN", "República de Corea": "KOR", "Ecuador": "ECU", "Austria": "AUT", "Australia": "AUS",
      "Noruega": "NOR", "Panamá": "PAN", "Egipto": "EGY", "Argelia": "ALG", "Escocia": "SCO", "Paraguay": "PAR",
      "Túnez": "TUN", "Costa de Marfil": "CIV", "Uzbekistán": "UZB", "Catar": "QAT", "A. Saudita": "KSA", "Sudáfrica": "RSA",
      "Jordania": "JOR", "Cabo Verde": "CPV", "Ghana": "GHA", "Curazao": "CUW", "Haití": "HTI", "Nueva Zelanda": "NZL",
      "R. EUROPA 1": "EU1", "R. EUROPA 2": "EU2", "R. EUROPA 3": "EU3", "R. EUROPA 4": "EU4",
      "R. INTERCONT 1": "INT1", "R. INTERCONT 2": "INT2"
    };

    const socket = io();
    let previousData = {};
    let groupsData = {};
    
    // Países con fondo blanco que necesitan borde negro
    const countriesWithWhiteBackground = ['dz', 'qa', 'kr', 'jp', 'gb-eng', 'pa'];
    
    // Configuración del resplandor de colores de bandera
    let glowConfig = {
      x: 960,
      y: 540,
      width: 600,
      height: 400,
      brightness: 0
    };

    // Initialize previousData and groupsData structure
    ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'].forEach(letter => {
      previousData[letter] = ['', '', '', ''];
      groupsData[letter] = ['', '', '', ''];
    });

    function setBorderVisibility(flagElement, visible) {
      const borderElement = document.getElementById('border-' + flagElement.id);
      if (borderElement) {
        if (visible) {
          borderElement.setAttribute('stroke', '#555555');
        } else {
          borderElement.setAttribute('stroke', 'none');
        }
      }
    }

    // Mapeo de nombres equivalentes (para compatibilidad con datos antiguos)
    const equivalentNames = {
      "Holanda": "Países Bajos",
      "Países Bajos": "Holanda"
    };

    function isTeamAssignedInOverlay(teamName) {
      // Verificar si el equipo ya está en algún grupo
      // También verificar el nombre equivalente (ej: Holanda <-> Países Bajos)
      const altName = equivalentNames[teamName];
      for (const groupLetter of ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L']) {
        if (groupsData[groupLetter].includes(teamName)) {
          return true;
        }
        if (altName && groupsData[groupLetter].includes(altName)) {
          return true;
        }
      }
      return false;
    }

    // Preload all flag images with loading screen
    async function preloadAllFlags() {
      const loadingScreen = document.getElementById('loading-screen');
      const loadingProgress = document.getElementById('loading-progress');
      const svgElement = document.getElementById('Capa_1');
      
      // Collect all unique flag codes to preload
      const flagCodes = Object.values(countryToCode);
      const uniqueFlags = [...new Set(flagCodes)];
      
      // Add placeholder and background image
      const allFlags = [...uniqueFlags, 'inc', 'fondo'];
      
      let loadedCount = 0;
      const totalFlags = allFlags.length;
      
      console.log(`Precargando ${totalFlags} banderas...`);
      
      // Create promises for all flag images
      const loadPromises = allFlags.map(code => {
        return new Promise((resolve, reject) => {
          const img = new Image();
          
          img.onload = () => {
            loadedCount++;
            const progress = Math.round((loadedCount / totalFlags) * 100);
            loadingProgress.textContent = `${progress}%`;
            console.log(`Cargada bandera ${code}: ${loadedCount}/${totalFlags}`);
            resolve();
          };
          
          img.onerror = () => {
            loadedCount++;
            const progress = Math.round((loadedCount / totalFlags) * 100);
            loadingProgress.textContent = `${progress}%`;
            console.warn(`Error cargando bandera: ${code}`);
            resolve(); // Resolve anyway to continue
          };
          
          img.src = `/w2560/${code}.png`;
        });
      });
      
      // Wait for all flags to load
      await Promise.all(loadPromises);
      
      console.log('Todas las banderas cargadas');
      
      // Hide loading screen and show content
      setTimeout(() => {
        console.log('Iniciando transición de pantalla de carga...');
        
        // Hide loading screen
        loadingScreen.classList.add('hidden');
        
        // Show SVG content (SVG elements need setAttribute for classes)
        svgElement.setAttribute('class', 'loaded');
        svgElement.style.opacity = '1';
        
        console.log('Pantalla de carga ocultada, contenido visible');
        
        // Desbugear: seleccionar y deseleccionar Argentina después de cargar
        setTimeout(() => {
          // Buscar el índice de Argentina en el bombo actual
          const bomboTeams = bombos[currentBombo] || [];
          const argIndex = bomboTeams.findIndex(team => team === 'Argentina');
          
          if (argIndex !== -1) {
            console.log('Desbugear: Seleccionando Argentina (índice ' + argIndex + ')');
            updateCountryHighlight(argIndex);
            
            // Deseleccionar después de un breve momento
            setTimeout(() => {
              console.log('Desbugear: Deseleccionando Argentina');
              updateCountryHighlight(-1);
            }, 10);
          } else {
            console.log('Desbugear: Argentina no encontrada en bombo actual, seleccionando índice 0');
            updateCountryHighlight(0);
            setTimeout(() => {
              updateCountryHighlight(-1);
            }, 10);
          }
        }, 300);
      }, 500);
    }
    
    // Wait for DOM to be fully loaded before starting preload
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', preloadAllFlags);
    } else {
      // DOM already loaded
      preloadAllFlags();
    }

    // ===================================================================
    // CONFIGURACIÓN DE BANDERAS DE BOMBOS (controlada desde panel de control)
    // ===================================================================
    let bomboFlagsOffsetX = -300;  // Offset horizontal (positivo = derecha, negativo = izquierda)
    let bomboFlagsOffsetY = -205;  // Offset vertical (positivo = abajo, negativo = arriba)
    let bomboFlagsColumnSpacing = 155;  // Separación entre columnas (distancia horizontal entre banderas)
    let bomboFlagsRowSpacing = 45;      // Separación entre filas (distancia vertical entre banderas)
    let bomboFlagWidth = 48;             // Ancho de cada bandera
    let bomboFlagHeight = 32;            // Alto de cada bandera
    // ===================================================================

    // Función para crear las banderas de bombos en CSS
    function createBomboFlagsCSS() {
      const container = document.getElementById('bombo-flags-container');
      if (!container) return;
      
      // Limpiar banderas existentes
      container.innerHTML = '';
      
      // Calcular posiciones dinámicamente usando las variables de configuración
      const baseColX = 222; // Posición X de la primera columna
      const baseRowY = 265; // Posición Y de la primera fila
      
      const cols = [
        baseColX, 
        baseColX + bomboFlagsColumnSpacing, 
        baseColX + bomboFlagsColumnSpacing * 2
      ];
      
      const rows = [
        baseRowY,
        baseRowY + bomboFlagsRowSpacing,
        baseRowY + bomboFlagsRowSpacing * 2,
        baseRowY + bomboFlagsRowSpacing * 3
      ];
      
      // Crear 12 banderas para cada bombo (4 bombos)
      for (let bombo = 1; bombo <= 4; bombo++) {
        const suffix = bombo === 1 ? '' : `-b${bombo}`;
        
        for (let i = 0; i < 12; i++) {
          const col = Math.floor(i / 4);
          const row = i % 4;
          
          const img = document.createElement('img');
          img.id = `bombo-flag-css-${i}${suffix}`;
          img.className = 'bombo-flag-css';
          img.src = '/w2560/inc.png';
          img.style.left = `${cols[col] + bomboFlagsOffsetX}px`;
          img.style.top = `${rows[row] + bomboFlagsOffsetY}px`;
          img.style.width = `${bomboFlagWidth}px`;
          img.style.height = `${bomboFlagHeight}px`;
          img.style.display = bombo === 1 ? 'block' : 'none'; // Solo mostrar bombo 1 inicialmente
          img.dataset.bombo = bombo;
          img.dataset.index = i;
          
          container.appendChild(img);
        }
      }
      
      console.log('Banderas CSS creadas');
    }
    
    // Crear banderas CSS al cargar
    createBomboFlagsCSS();
    
    // ===================================================================
    // CONFIGURACIÓN DE BANDERAS Y TEXTOS DE GRUPOS EN CSS
    // ===================================================================
    // Posiciones base de cada grupo (coordenadas SVG originales)
    const groupBasePositions = {
      A: { flagX: 210.63, textX: 272.65, startY: 591.27, textOffsetY: 22.21 },
      B: { flagX: 471.49, textX: 533.51, startY: 591.27, textOffsetY: 22.21 },
      C: { flagX: 732.35, textX: 794.37, startY: 591.27, textOffsetY: 22.21 },
      D: { flagX: 993.21, textX: 1055.23, startY: 591.27, textOffsetY: 22.21 },
      E: { flagX: 1254.07, textX: 1316.09, startY: 591.27, textOffsetY: 22.21 },
      F: { flagX: 1514.93, textX: 1576.95, startY: 591.27, textOffsetY: 22.21 },
      G: { flagX: 210.63, textX: 272.65, startY: 856.47, textOffsetY: 22.21 },
      H: { flagX: 471.49, textX: 533.51, startY: 856.47, textOffsetY: 22.21 },
      I: { flagX: 732.35, textX: 794.37, startY: 856.47, textOffsetY: 22.21 },
      J: { flagX: 993.21, textX: 1055.23, startY: 856.47, textOffsetY: 22.21 },
      K: { flagX: 1254.07, textX: 1316.09, startY: 856.47, textOffsetY: 22.21 },
      L: { flagX: 1514.93, textX: 1576.95, startY: 856.47, textOffsetY: 22.21 }
    };
    const groupSlotSpacing = 44.98; // Espaciado vertical entre slots
    
    // Función para crear banderas y textos de grupos en CSS
    function createGroupSlotsCSS() {
      const container = document.getElementById('groups-flags-container');
      if (!container) return;
      
      container.innerHTML = '';
      
      const groups = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];
      
      groups.forEach(groupName => {
        const pos = groupBasePositions[groupName];
        
        for (let slot = 1; slot <= 4; slot++) {
          const slotY = pos.startY + (slot - 1) * groupSlotSpacing;
          
          // Crear contenedor del slot
          const slotDiv = document.createElement('div');
          slotDiv.id = `group-slot-${groupName}${slot}`;
          slotDiv.className = 'group-slot visible'; // Visible por defecto con placeholder
          slotDiv.style.left = `${pos.flagX}px`;
          slotDiv.style.top = `${slotY}px`;
          slotDiv.dataset.group = groupName;
          slotDiv.dataset.slot = slot;
          
          // Crear imagen de bandera (placeholder por defecto)
          const flagImg = document.createElement('img');
          flagImg.id = `group-flag-css-${groupName}${slot}`;
          flagImg.className = 'group-flag-css';
          flagImg.src = '/w2560/inc.png';
          
          // Crear texto del nombre (placeholder por defecto)
          const nameSpan = document.createElement('span');
          nameSpan.id = `group-name-css-${groupName}${slot}`;
          nameSpan.className = 'group-team-name placeholder';
          nameSpan.textContent = `Pais ${slot}`;
          
          slotDiv.appendChild(flagImg);
          slotDiv.appendChild(nameSpan);
          container.appendChild(slotDiv);
        }
      });
      
      console.log('Slots de grupos CSS creados');
    }
    
    // Crear slots de grupos al cargar
    createGroupSlotsCSS();
    
    // Apply rounded corners to all flag images
    document.querySelectorAll('image[id^="flag"]').forEach(img => {
      // Bombo flags use bombo clipPath, group flags use groups clipPath
      if (img.id.startsWith('bombo-flag')) {
        img.setAttribute('clip-path', 'url(#flag-rounded-bombo)');
      } else {
        img.setAttribute('clip-path', 'url(#flag-rounded-groups)');
      }
    });

    socket.on('groups_update', (data) => {
      console.log('Data updated from server (overlay3)');

      // Actualizamos info de grupos
      groupsData = JSON.parse(JSON.stringify(data));
      updateDisplay(data);
      updateBomboDisplay(currentBombo);

      // Apenas se asigna un equipo a un grupo, apagamos
      updateCountryHighlight(-1);
    });


    let currentBombo = 1;

    function updateDisplay(data) {
      ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'].forEach(groupName => {
        const teams = data[groupName] || ['', '', '', ''];
        for (let i = 0; i < 4; i++) {
          const slotNumber = i + 1;
          const textId = `${groupName}${slotNumber}`;
          const flagId = `flag${groupName}${slotNumber}`;
          const textElement = document.getElementById(textId);
          const flagElement = document.getElementById(flagId);
          
          // Referencias a elementos CSS
          const cssFlagElement = document.getElementById(`group-flag-css-${groupName}${slotNumber}`);
          const cssNameElement = document.getElementById(`group-name-css-${groupName}${slotNumber}`);
          
          const teamName = teams[i] ? teams[i].trim() : '';
          const previousTeamName = previousData[groupName][i] ? previousData[groupName][i].trim() : '';
          const isNewTeam = teamName !== previousTeamName && teamName !== '';
          
          // === ACTUALIZAR ELEMENTOS CSS ===
          if (cssFlagElement && cssNameElement) {
            if (!teamName) {
              // Mostrar placeholder cuando no hay equipo
              cssFlagElement.src = '/w2560/inc.png';
              cssFlagElement.style.opacity = '1';
              cssFlagElement.classList.remove('white-border');
              cssNameElement.textContent = `Pais ${slotNumber}`;
              cssNameElement.classList.add('placeholder');
              cssNameElement.style.opacity = '1';
            } else {
              // Mostrar equipo real
              const displayName = countryDisplayAliases[teamName] || teamName;
              cssNameElement.textContent = displayName;
              cssNameElement.classList.remove('placeholder');
              
              if (countryToCode[teamName]) {
                const code = countryToCode[teamName];
                cssFlagElement.src = `/w2560/${code}.png`;
                
                // Agregar/quitar borde si el país tiene fondo blanco
                if (countriesWithWhiteBackground.includes(code)) {
                  cssFlagElement.classList.add('white-border');
                } else {
                  cssFlagElement.classList.remove('white-border');
                }
              } else {
                cssFlagElement.src = '/w2560/inc.png';
                cssFlagElement.classList.remove('white-border');
              }
              
              cssFlagElement.style.opacity = '1';
              cssNameElement.style.opacity = '1';
              
              // Animación para nuevos equipos
              if (isNewTeam) {
                cssNameElement.classList.add('team-name-animate');
                setTimeout(() => {
                  cssNameElement.classList.remove('team-name-animate');
                }, 800);
              }
            }
          }
          
          // === ACTUALIZAR ELEMENTOS SVG (mantener para compatibilidad) ===
          if (textElement && flagElement) {
            // Si no hay equipo asignado, mostrar placeholder
            if (!teamName) {
              flagElement.style.opacity = '1';
              textElement.style.opacity = '1';
              textElement.textContent = `Pais ${slotNumber}`;
              textElement.setAttribute('fill', '#666666');
              textElement.style.fontStyle = 'normal';
              flagElement.href.baseVal = '/w2560/inc.png';
              setBorderVisibility(flagElement, false);
              continue;
            }

            // Aplicar alias para nombres de países
            const displayName = countryDisplayAliases[teamName] || teamName;
            textElement.textContent = displayName;
            textElement.setAttribute('fill', '#ffffff');
            textElement.style.fontStyle = 'normal';
            
            if (countryToCode[teamName]) {
              const code = countryToCode[teamName];
              flagElement.href.baseVal = `/w2560/${code}.png`;
              
              // Agregar borde si el país tiene fondo blanco
              setBorderVisibility(flagElement, countriesWithWhiteBackground.includes(code));
            } else {
              flagElement.href.baseVal = '/w2560/inc.png';
              setBorderVisibility(flagElement, false);
            }
            
            // Mostrar bandera (siempre visible cuando hay equipo)
            flagElement.style.opacity = '1';
            textElement.style.opacity = '1';

            // Apply animations only when a new team is added
            if (isNewTeam) {
              console.log('Animating new team:', teamName, 'at', textId);
              
              // Ensure flag is visible immediately (no fade animation on flag)
              flagElement.style.opacity = '1';
              flagElement.style.transition = 'none';
              
              // Get text position for clipPath IMMEDIATELY
              const textBBox = textElement.getBBox();
              const clipPathId = 'clipPath-' + textId;
              const defs = document.getElementById('svg-defs');
              
              // Remove existing clipPath if any
              const existingClip = document.getElementById(clipPathId);
              if (existingClip) existingClip.remove();
              
              // Create clipPath with width 0 BEFORE any animation
              const clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');
              clipPath.id = clipPathId;
              
              const clipRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
              clipRect.setAttribute('x', textBBox.x);
              clipRect.setAttribute('y', textBBox.y);
              clipRect.setAttribute('width', '0');
              clipRect.setAttribute('height', textBBox.height);
              
              clipPath.appendChild(clipRect);
              defs.appendChild(clipPath);
              
              // Apply clipPath to text IMMEDIATELY (hides text)
              textElement.setAttribute('clip-path', 'url(#' + clipPathId + ')');
              
              // Animate text sweep after a small delay
              setTimeout(() => {
                clipRect.style.transition = 'width 0.8s ease-in-out';
                clipRect.setAttribute('width', textBBox.width);
                
                // Remove clip-path after animation completes
                setTimeout(() => {
                  textElement.removeAttribute('clip-path');
                }, 800);
              }, 100);
              
            } else {
              // For existing teams (no change), ensure they're visible
              textElement.removeAttribute('clip-path');
            }
          }
        }
      });

      // Update previousData for next comparison
      previousData = JSON.parse(JSON.stringify(data));
    }

    socket.on('highlighted_group_update', (highlightedGroup) => {
      console.log('Highlighted group update received:', highlightedGroup);
      
      // Resetear todos los headers a negro
      const allGroups = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];
      allGroups.forEach(letter => {
        const header = document.getElementById('header' + letter);
        if (header) {
          if (letter === highlightedGroup) {
            header.setAttribute('fill', 'none'); // Dorado oscuro
          } else {
            header.setAttribute('fill', 'none'); // Negro
          }
        }
      });
    });

    socket.on('bombo_update', (bomboNumber) => {
      console.log('Bombo update received:', bomboNumber);
      // Desdestacar país si hay alguno seleccionado antes de cambiar de bombo
      updateCountryHighlight(-1);
      currentBombo = bomboNumber;
      updateBomboDisplay(bomboNumber);
    });

    // Evento desde el panel: un equipo fue transferido desde un bombo a un grupo
    socket.on('team_transfer', (info) => {
      console.log('Team transfer recibido:', info);
      animateFlagTransfer(info);
    });
    socket.on('highlighted_country_update', (countryIndex) => {
      console.log('Highlighted country update received:', countryIndex);

      // Si viene -1 o algo inválido, simplemente apagamos todo
      if (countryIndex == null || countryIndex < 0) {
        updateCountryHighlight(-1);
        return;
      }

      // País correspondiente al índice en el bombo actualmente visible
      const bomboTeams = bombos[currentBombo] || [];
      const teamName = bomboTeams[countryIndex];

      // Si ese país YA está en algún grupo, ignoramos el highlight
      if (teamName && isTeamAssignedInOverlay(teamName)) {
        console.log('Ignoring highlight for already assigned team:', teamName);
        updateCountryHighlight(-1);
        return;
      }

      // Si no está asignado, sí lo destacamos normalmente
      updateCountryHighlight(countryIndex);
    });


    function updateCountryHighlight(countryIndex) {
      // Sufijo de IDs según el bombo actual
      const suffixForBombo = (b) => (b === 1 ? '' : `-b${b}`);
      const suffix = suffixForBombo(currentBombo);
      
      // Obtener referencia a la imagen de fondo de líneas (HTML layer)
      const backgroundLines = document.getElementById('bg-lines');

      // 1) Apagar TODOS los rectángulos dorados de TODOS los bombos
      for (let b = 1; b <= 4; b++) {
        const sfx = suffixForBombo(b);
        for (let i = 0; i < 12; i++) {
          const highlightElement = document.getElementById(`country-highlight-${i}${sfx}`);
          if (highlightElement) {
            highlightElement.setAttribute('opacity', '0');
          }
        }
      }

      // 1b) Resetear TODAS las banderas CSS a su estado normal
      // (pero mantener la clase 'assigned' si corresponde)
      document.querySelectorAll('.bombo-flag-css').forEach(flag => {
        // Remover clases de highlight pero preservar 'assigned' (blanco y negro)
        flag.classList.remove('highlighted', 'dimmed');
        flag.style.transform = '';
        flag.style.left = '';
        flag.style.top = '';
        flag.style.width = `${bomboFlagWidth}px`;
        flag.style.height = `${bomboFlagHeight}px`;
        flag.style.zIndex = '';
        
        // Restaurar posición original con offset aplicado usando variables de configuración
        const col = Math.floor(parseInt(flag.dataset.index) / 4);
        const row = parseInt(flag.dataset.index) % 4;
        
        const baseColX = 222;
        const baseRowY = 265;
        const cols = [
          baseColX, 
          baseColX + bomboFlagsColumnSpacing, 
          baseColX + bomboFlagsColumnSpacing * 2
        ];
        const rows = [
          baseRowY,
          baseRowY + bomboFlagsRowSpacing,
          baseRowY + bomboFlagsRowSpacing * 2,
          baseRowY + bomboFlagsRowSpacing * 3
        ];
        
        flag.style.left = `${cols[col] + bomboFlagsOffsetX}px`;
        flag.style.top = `${rows[row] + bomboFlagsOffsetY}px`;
      });
      
      // Resetear texto del nombre del país destacado
      const featuredCountryName = document.getElementById('featured-country-name');
      if (featuredCountryName) {
        featuredCountryName.textContent = '';
        featuredCountryName.style.opacity = '0';
      }
      
      // Ocultar todas las capas especiales con fade out
      document.querySelectorAll('.special-layer').forEach(layer => {
        layer.classList.remove('visible');
      });
      
      // Resetear resplandor de colores de bandera con fade out suave
      const countryGlow = document.getElementById('country-glow');
      if (countryGlow) {
        // Detener efecto de respiración
        countryGlow.classList.remove('breathing');
        // Primero hacer fade out (la transición CSS de 0.5s se encarga)
        countryGlow.style.opacity = '0';
        // Limpiar estilos después de que termine la transición
        setTimeout(() => {
          if (countryGlow.style.opacity === '0') {
            countryGlow.style.border = 'none';
            countryGlow.style.borderImage = 'none';
            countryGlow.style.boxShadow = 'none';
          }
        }, 550);
      }
      
      // Resetear textos del bombo
      for (let i = 0; i < 12; i++) {
        const teamText = document.getElementById(`bombo-team-${i}${suffix}`);
        if (teamText) teamText.style.opacity = '1';
      }

      // 2) Si el panel manda null / undefined / -1 / fuera de rango → no mostrar nada
      if (typeof countryIndex !== 'number' || countryIndex < 0 || countryIndex >= 12) {
        // Restaurar fondo de líneas (fade in)
        if (backgroundLines) {
          backgroundLines.style.opacity = '1';
        }
        return;
      }

      // 3) Obtener información del país destacado
      const bomboTeams = bombos[currentBombo] || [];
      const teamName = bomboTeams[countryIndex];
      if (!teamName) return;

      // 3b) Mostrar capa especial según el país destacado
      const specialLayers = {
        'R. EUROPA 1': 'eu1-layer',
        'R. EUROPA 2': 'eu2-layer',
        'R. EUROPA 3': 'eu3-layer',
        'R. EUROPA 4': 'eu4-layer',
        'R. INTERCONT 1': 'int1-layer',
        'R. INTERCONT 2': 'in2-layer'
      };
      
      const layerId = specialLayers[teamName];
      if (layerId) {
        const layer = document.getElementById(layerId);
        if (layer) {
          layer.classList.add('visible');
        }
      }

      // 4) Ocultar las OTRAS banderas del bombo actual (no la destacada)
      document.querySelectorAll(`.bombo-flag-css[data-bombo="${currentBombo}"]`).forEach(flag => {
        const index = parseInt(flag.dataset.index);
        if (index !== countryIndex) {
          flag.classList.add('dimmed');
        }
      });
      
      // 4b) Ocultar TODOS los textos del bombo con fade out
      for (let i = 0; i < 12; i++) {
        const teamText = document.getElementById(`bombo-team-${i}${suffix}`);
        if (teamText) {
          teamText.style.opacity = '0';
        }
      }

      // 5) Animar la bandera destacada al centro del bombo
      const highlightedFlag = document.getElementById(`bombo-flag-css-${countryIndex}${suffix}`);
      const teamText = document.getElementById(`bombo-team-${countryIndex}${suffix}`);
      
      // Hacer fade out del fondo de líneas cuando se destaca una bandera
      if (backgroundLines) {
        backgroundLines.style.opacity = '0';
      }
      
      if (highlightedFlag) {
        // Ocultar el texto pequeño
        if (teamText) teamText.style.opacity = '0';
        
        // Marcar como destacada
        highlightedFlag.classList.add('highlighted');
        
        // Calcular posición del centro usando las mismas variables de configuración
        const baseColX = 222;
        const baseRowY = 265;
        const cols = [
          baseColX, 
          baseColX + bomboFlagsColumnSpacing, 
          baseColX + bomboFlagsColumnSpacing * 2
        ];
        const rows = [
          baseRowY,
          baseRowY + bomboFlagsRowSpacing,
          baseRowY + bomboFlagsRowSpacing * 2,
          baseRowY + bomboFlagsRowSpacing * 3
        ];
        
        const FEATURED_FLAG_OFFSET = {
          x: -17,   // la corre 20px a la derecha
          y: -20   // la sube 10px
        };
        
        const centerCol = 1; // Columna 2 (índice 1)
        const centerRow = 1; // Fila 2 (índice 1)
        const centerX = cols[centerCol] + bomboFlagsOffsetX + FEATURED_FLAG_OFFSET.x;
        const centerY = rows[centerRow] + bomboFlagsOffsetY + FEATURED_FLAG_OFFSET.y;

        // Tamaño de la bandera agrandada
        const enlargedWidth = bomboFlagWidth * 2.75;
        const enlargedHeight = bomboFlagHeight * 2.75;
        
        // Mover al centro y agrandar (3x el tamaño configurado)
        highlightedFlag.style.left = `${centerX}px`;
        highlightedFlag.style.top = `${centerY}px`;
        highlightedFlag.style.width = `${enlargedWidth}px`;
        highlightedFlag.style.height = `${enlargedHeight}px`;
        highlightedFlag.style.zIndex = '100';
        
        // Mostrar el nombre del país debajo de la bandera (HTML)
        const featuredCountryName = document.getElementById('featured-country-name');
        if (featuredCountryName) {
          const displayName = countryDisplayAliases[teamName] || teamName;
          featuredCountryName.textContent = displayName;
          
          // Posicionar debajo de la bandera grande, centrado
          // Necesitamos escalar las coordenadas al tamaño real de la ventana
          const svg = document.getElementById('Capa_1');
          const svgRect = svg.getBoundingClientRect();
          const scaleX = svgRect.width / 1920;
          const scaleY = svgRect.height / 1080;
          
          const textX = (centerX + (enlargedWidth / 2)) * scaleX + svgRect.left;
          const textY = (centerY + enlargedHeight + 20) * scaleY + svgRect.top;
          
          featuredCountryName.style.left = `${textX}px`;
          featuredCountryName.style.top = `${textY}px`;
          featuredCountryName.style.transform = 'translateX(-50%)';
          featuredCountryName.style.opacity = '1';
          
          console.log('Texto destacado:', { displayName, textX, textY, scaleX, scaleY });
        }
        
        // Mostrar resplandor rectangular con colores del BORDE EXTERIOR de la bandera
        const countryGlow = document.getElementById('country-glow');
        if (countryGlow) {
          const flagData = countryFlagData[teamName] || { 
            top: ['#FFFFFF'], bottom: ['#CCCCCC'], left: ['#FFFFFF'], right: ['#CCCCCC'] 
          };
          
          // Escalar posición y tamaño al tamaño real de la ventana
          const svg = document.getElementById('Capa_1');
          const svgRect = svg.getBoundingClientRect();
          const scaleX = svgRect.width / 1920;
          const scaleY = svgRect.height / 1080;
          
          const glowX = glowConfig.x * scaleX + svgRect.left;
          const glowY = glowConfig.y * scaleY + svgRect.top;
          const glowWidth = glowConfig.width * scaleX;
          const glowHeight = glowConfig.height * scaleY;
          const brightness = glowConfig.brightness || 1.0;
          const borderWidth = Math.max(6, 12 * brightness);
          
          // Función para crear gradiente de un borde
          function createEdgeGradient(colors, stops, angle) {
            let gradientStops = [];
            const numColors = colors.length;
            if (stops && stops.length === numColors) {
              colors.forEach((color, i) => {
                const startPct = i === 0 ? 0 : stops[i - 1];
                const endPct = stops[i];
                gradientStops.push(`${color} ${startPct}%`);
                gradientStops.push(`${color} ${endPct}%`);
              });
            } else {
              colors.forEach((color, i) => {
                const startPct = (i / numColors) * 100;
                const endPct = ((i + 1) / numColors) * 100;
                gradientStops.push(`${color} ${startPct}%`);
                gradientStops.push(`${color} ${endPct}%`);
              });
            }
            return `linear-gradient(${angle}, ${gradientStops.join(', ')})`;
          }
          
          // Gradientes para cada borde (top/bottom = horizontal 90deg, left/right = vertical 180deg)
          const topGradient = createEdgeGradient(flagData.top, flagData.topStops, '90deg');
          const bottomGradient = createEdgeGradient(flagData.bottom, flagData.bottomStops, '90deg');
          const leftGradient = createEdgeGradient(flagData.left, flagData.leftStops, '180deg');
          const rightGradient = createEdgeGradient(flagData.right, flagData.rightStops, '180deg');
          
          // Usar 4 backgrounds posicionados para crear los 4 bordes
          const backgrounds = [
            `${topGradient}`,     // top
            `${bottomGradient}`,  // bottom
            `${leftGradient}`,    // left
            `${rightGradient}`    // right
          ];
          
          const backgroundSizes = [
            `100% ${borderWidth}px`,  // top
            `100% ${borderWidth}px`,  // bottom
            `${borderWidth}px 100%`,  // left
            `${borderWidth}px 100%`   // right
          ];
          
          const backgroundPositions = [
            'top left',     // top
            'bottom left',  // bottom
            'top left',     // left
            'top right'     // right
          ];
          
     // Recolectar colores únicos para box-shadow
     const allColors = new Set([...flagData.top, ...flagData.bottom, ...flagData.left, ...flagData.right]);
     const glowBlur = 30 * brightness;
     const glowSpread = 5 * brightness;
     let boxShadows = [];
     boxShadows.push(`0 0 ${glowBlur * 2}px 2px rgba(0, 0, 0, 0.7)`);
     allColors.forEach(color => {
       boxShadows.push(`0 0 ${glowBlur}px ${glowSpread}px ${color}`);
       boxShadows.push(`0 0 ${glowBlur * 2}px ${glowSpread * 0.5}px ${color}`);
     });


          
          // Desactivar transiciones temporalmente para configurar tamaño sin animación
          countryGlow.style.transition = 'none';
          countryGlow.style.opacity = '0';
          
          // Configurar posición y estilos mientras está invisible
          countryGlow.style.left = `${glowX - glowWidth/2}px`;
          countryGlow.style.top = `${glowY - glowHeight/2}px`;
          countryGlow.style.width = `${glowWidth}px`;
          countryGlow.style.height = `${glowHeight}px`;
          countryGlow.style.background = backgrounds.join(', ');
          countryGlow.style.backgroundSize = backgroundSizes.join(', ');
          countryGlow.style.backgroundPosition = backgroundPositions.join(', ');
          countryGlow.style.backgroundRepeat = 'no-repeat';
          countryGlow.style.border = 'none';
          countryGlow.style.borderImage = 'none';
          countryGlow.style.boxShadow = 'none';
          // Establecer escala inicial igual a la de respiración para evitar salto
          countryGlow.style.transform = 'scale(1.07)';
          
          // Forzar reflow para aplicar todos los estilos inmediatamente
          void countryGlow.offsetWidth;
          
          // Restaurar transiciones y hacer fade in
          const targetOpacity = Math.min(brightness * 1.2, 1).toString();
          countryGlow.style.transition = 'opacity 0.5s ease-in-out';
          
          // Hacer fade in en el siguiente frame
          requestAnimationFrame(() => {
            countryGlow.style.opacity = targetOpacity;
            // Activar efecto de respiración después del fade in
            setTimeout(() => {
              countryGlow.classList.add('breathing');
            }, 500);
          });


          
          console.log('Resplandor borde exterior:', { teamName, top: flagData.top, bottom: flagData.bottom, left: flagData.left, right: flagData.right });
        }
        
        console.log('Bandera destacada:', { countryIndex, teamName, centerX, centerY });
      }
    }
    // Animación: bandera "vuela" desde el bombo al grupo
    function animateFlagTransfer({ teamName, fromBombo, fromIndex, toGroup, toSlot }) {
      try {
        const suffix = fromBombo === 1 ? '' : `-b${fromBombo}`;
        const sourceFlag = document.getElementById(`bombo-flag-${fromIndex}${suffix}`);
        const targetFlag = document.getElementById(`flag${toGroup}${toSlot + 1}`);

        if (!sourceFlag || !targetFlag) {
          console.warn('No se encontró bandera origen o destino para animación', {
            sourceFlagId: `bombo-flag-${fromIndex}${suffix}`,
            targetFlagId: `flag${toGroup}${toSlot + 1}`
          });
          return;
        }

        const flyingFlag = document.getElementById('flying-flag');
        if (!flyingFlag) return;

        // Código de la bandera
        const code = countryToCode[teamName] || 'inc';
        flyingFlag.src = `/w2560/${code}.png`;

        // Posiciones en pantalla (ya con el SVG escalado)
        const srcRect = sourceFlag.getBoundingClientRect();
        const dstRect = targetFlag.getBoundingClientRect();

        // Apagar el highlight dorado inmediatamente
        updateCountryHighlight(-1);

        // Estado inicial: bandera en la posición del bombo
        flyingFlag.style.display = 'block';
        flyingFlag.style.opacity = '1';
        flyingFlag.style.left = `${srcRect.left}px`;
        flyingFlag.style.top = `${srcRect.top}px`;
        flyingFlag.style.width = `${srcRect.width}px`;
        flyingFlag.style.height = `${srcRect.height}px`;

        // Forzar reflow para que la transición dispare bien
        void flyingFlag.offsetWidth;

        // Mover a la posición destino (grupo)
        setTimeout(() => {
          flyingFlag.style.left = `${dstRect.left}px`;
          flyingFlag.style.top = `${dstRect.top}px`;
          flyingFlag.style.width = `${dstRect.width}px`;
          flyingFlag.style.height = `${dstRect.height}px`;
        }, 20);

        // Después de viajar, desvanecer y ocultar
        const travelMs = 500;
        setTimeout(() => {
          flyingFlag.style.opacity = '0';
          setTimeout(() => {
            flyingFlag.style.display = 'none';
          }, 200);
        }, travelMs);

      } catch (err) {
        console.error('Error en animateFlagTransfer:', err);
      }
    }


    
    function updateBomboDisplay(bomboNumber) {
      currentBombo = bomboNumber;
      const bomboTeams = bombos[bomboNumber] || [];
      
      // Encontrar el bombo visible actualmente
      let visibleBombo = null;
      for (let b = 1; b <= 4; b++) {
        const container = document.getElementById(`bombo-container-${b}`);
        if (container && container.style.display !== 'none') {
          visibleBombo = container;
          break;
        }
      }
      
      // Función para actualizar el contenido del bombo
      const updateBomboContent = () => {
        // Determinar sufijo del bombo para los IDs
        const suffix = bomboNumber === 1 ? '' : `-b${bomboNumber}`;
        
        // Ocultar/mostrar banderas CSS según el bombo activo
        document.querySelectorAll('.bombo-flag-css').forEach(flag => {
          const flagBombo = parseInt(flag.dataset.bombo);
          flag.style.display = flagBombo === bomboNumber ? 'block' : 'none';
        });

        for (let i = 0; i < 12; i++) {
          const teamName = bomboTeams[i] || '';
          const teamElement = document.getElementById(`bombo-team-${i}${suffix}`);
          const flagElement = document.getElementById(`bombo-flag-${i}${suffix}`);
          const flagElementCSS = document.getElementById(`bombo-flag-css-${i}${suffix}`);
          const isAssigned = isTeamAssignedInOverlay(teamName);
          
          // Actualizar bandera CSS
          if (flagElementCSS) {
            if (teamName && countryToCode[teamName]) {
              const code = countryToCode[teamName];
              flagElementCSS.src = `/w2560/${code}.png`;
            } else {
              flagElementCSS.src = '/w2560/inc.png';
            }
            
            // Aplicar clase de asignado (blanco y negro) si corresponde
            if (isAssigned) {
              flagElementCSS.classList.add('assigned');
            } else {
              flagElementCSS.classList.remove('assigned');
            }
          }

          if (teamElement) {
            const abbreviation = teamName ? (countryAbbreviations[teamName] || teamName) : '';
            teamElement.textContent = abbreviation;
            
            // Aplicar estilos de equipo asignado
            if (isAssigned) {
              teamElement.setAttribute('class', 'cls-8 assigned-text');
            } else {
              teamElement.setAttribute('class', 'cls-8');
            }
          }

          if (flagElement) {
            if (teamName && countryToCode[teamName]) {
              const code = countryToCode[teamName];
              flagElement.href.baseVal = `/w2560/${code}.png`;
              
              // Agregar borde si el país tiene fondo blanco
              const borderElement = document.getElementById(`border-bombo-flag-${i}${suffix}`);
              if (borderElement) {
                if (countriesWithWhiteBackground.includes(code)) {
                  borderElement.setAttribute('stroke', '#555555');
                } else {
                  borderElement.setAttribute('stroke', 'none');
                }
              }
            } else {
              flagElement.href.baseVal = '/w2560/inc.png';
              const borderElement = document.getElementById(`border-bombo-flag-${i}${suffix}`);
              if (borderElement) {
                borderElement.setAttribute('stroke', 'none');
              }
            }
            
            // Aplicar offset de posicionamiento manual (mismo para todas las banderas)
            flagElement.setAttribute('x', bomboFlagOffset.x);
            flagElement.setAttribute('y', bomboFlagOffset.y);
            
            // Aplicar filtro grayscale a banderas asignadas
            if (isAssigned) {
              flagElement.setAttribute('class', 'flag-image assigned-flag');
            } else {
              flagElement.setAttribute('class', 'flag-image');
            }
          }
        }
      };
      
      // Si hay un bombo visible y es diferente al que queremos mostrar, hacer fade out
      if (visibleBombo && visibleBombo.id !== `bombo-container-${bomboNumber}`) {
        visibleBombo.classList.add('fade-out');
        visibleBombo.classList.remove('fade-in');
        
        // Esperar a que termine el fade out antes de cambiar
        setTimeout(() => {
          // Ocultar todos los bombos
          for (let b = 1; b <= 4; b++) {
            const bomboContainer = document.getElementById(`bombo-container-${b}`);
            if (bomboContainer) {
              bomboContainer.style.display = 'none';
              bomboContainer.classList.remove('fade-out', 'fade-in');
            }
          }
          
          // Mostrar el nuevo bombo y hacer fade in
          const newBomboContainer = document.getElementById(`bombo-container-${bomboNumber}`);
          if (newBomboContainer) {
            newBomboContainer.style.display = 'block';
            // Forzar reflow para que la transición funcione
            newBomboContainer.offsetHeight;
            newBomboContainer.classList.add('fade-in');
          }
          
          // Actualizar contenido del nuevo bombo
          updateBomboContent();
        }, 400); // Tiempo de la transición CSS
      } else {
        // Si no hay bombo visible o es el mismo, mostrar directamente
        // Ocultar todos los bombos
        for (let b = 1; b <= 4; b++) {
          const bomboContainer = document.getElementById(`bombo-container-${b}`);
          if (bomboContainer) {
            bomboContainer.style.display = 'none';
            bomboContainer.classList.remove('fade-out', 'fade-in');
          }
        }
        
        // Mostrar el bombo actual con fade in
        const currentBomboContainer = document.getElementById(`bombo-container-${bomboNumber}`);
        if (currentBomboContainer) {
          currentBomboContainer.style.display = 'block';
          currentBomboContainer.offsetHeight;
          currentBomboContainer.classList.add('fade-in');
        }
        
        // Actualizar contenido
        updateBomboContent();
      }
    }

    socket.on('connect', () => {
      console.log('Connected to server (overlay3)');
      // Solicitar las transformaciones actuales
      socket.emit('request_current_state');
    });

    // ===== APLICACIÓN DE TRANSFORMACIONES DESDE SOCKET.IO =====
    
    // Cache de bounding boxes originales (sin transformaciones)
    const originalBBoxes = {};
    
    // Obtener el bounding box original de un elemento (sin transformaciones)
    function getOriginalBBox(element, cacheKey) {
      if (originalBBoxes[cacheKey]) {
        return originalBBoxes[cacheKey];
      }
      
      // Guardar estado actual
      const currentTransform = element.getAttribute('transform');
      const currentDisplay = element.style.display;
      
      // Limpiar transform temporalmente
      element.removeAttribute('transform');
      
      // Hacer visible si está oculto (para evitar DOMException en getBBox())
      const wasHidden = currentDisplay === 'none';
      if (wasHidden) {
        element.style.display = 'block';
      }
      
      // Obtener bounding box sin transformaciones
      const bbox = element.getBBox();
      originalBBoxes[cacheKey] = { x: bbox.x, y: bbox.y, width: bbox.width, height: bbox.height };
      
      // Restaurar estado original
      if (currentTransform) {
        element.setAttribute('transform', currentTransform);
      }
      if (wasHidden) {
        element.style.display = 'none';
      }
      
      return originalBBoxes[cacheKey];
    }
    
    // Aplicar posicionamiento absoluto a un grupo o bombo
    // x, y son coordenadas absolutas en pantalla 1920x1080 (esquina superior izquierda)
    // La transformación se aplica como: translate(x, y) scale(scaleX, scaleY) translate(-bbox.x, -bbox.y)
    // Esto garantiza que la esquina superior izquierda quede en (x, y) incluso con escala aplicada
    function applyTransform(type, id, transform) {
      const { x, y, scaleX, scaleY } = transform;
      
      if (type === 'group') {
        // Encontrar el grupo en el SVG
        const header = document.getElementById(`header${id}`);
        if (header) {
          const groupElement = header.parentElement;
          if (groupElement && groupElement.tagName.toLowerCase() === 'g') {
            // Obtener bounding box original del elemento (sin transformaciones)
            const bbox = getOriginalBBox(groupElement, `group-${id}`);
            
            // Aplicar transformación manteniendo la esquina superior izquierda en (x, y)
            // translate(x, y): mover a la posición absoluta
            // scale(scaleX, scaleY): escalar
            // translate(-bbox.x, -bbox.y): compensar el offset nativo del elemento
            const transformStr = `translate(${x}, ${y}) scale(${scaleX}, ${scaleY}) translate(${-bbox.x}, ${-bbox.y})`;
            groupElement.setAttribute('transform', transformStr);
            console.log(`Applied absolute position to group ${id}: top-left at (${x}, ${y}) scale(${scaleX}, ${scaleY})`);
          } else {
            console.warn(`Group element not found for ${id}`);
          }
        } else {
          console.warn(`Header not found: header${id}`);
        }
      } else if (type === 'bombo') {
        // Encontrar el contenedor del bombo
        const bomboContainer = document.getElementById(`bombo-container-${id}`);
        if (bomboContainer && bomboContainer.tagName.toLowerCase() === 'g') {
          // Obtener bounding box original del elemento (sin transformaciones)
          const bbox = getOriginalBBox(bomboContainer, `bombo-${id}`);
          
          // Aplicar transformación manteniendo la esquina superior izquierda en (x, y)
          const transformStr = `translate(${x}, ${y}) scale(${scaleX}, ${scaleY}) translate(${-bbox.x}, ${-bbox.y})`;
          bomboContainer.setAttribute('transform', transformStr);
          console.log(`Applied absolute position to bombo ${id}: top-left at (${x}, ${y}) scale(${scaleX}, ${scaleY})`);
        } else {
          console.warn(`Bombo container not found: bombo-container-${id}`);
        }
      }
    }

    // Escuchar actualizaciones de configuración de banderas desde el servidor
    socket.on('bombo_flags_config_update', (config) => {
      console.log('Bombo flags config update received', config);
      
      // Actualizar variables globales
      bomboFlagsOffsetX = config.offsetX;
      bomboFlagsOffsetY = config.offsetY;
      bomboFlagsColumnSpacing = config.columnSpacing;
      bomboFlagsRowSpacing = config.rowSpacing;
      bomboFlagWidth = config.width;
      bomboFlagHeight = config.height;
      
      // Recrear banderas con nueva configuración
      createBomboFlagsCSS();
      
      // Actualizar el display del bombo actual para restaurar las imágenes correctas
      updateBomboDisplay(currentBombo);
      
      // Si hay un país destacado, volver a aplicar el highlight
      if (highlightedCountryIndex >= 0) {
        updateCountryHighlight(highlightedCountryIndex);
      }
    });

    // Escuchar actualizaciones de configuración del resplandor desde el servidor
    socket.on('glow_config_update', (config) => {
      console.log('Glow config update received', config);
      
      // Actualizar configuración global
      glowConfig.x = config.x;
      glowConfig.y = config.y;
      glowConfig.width = config.width;
      glowConfig.height = config.height;
      glowConfig.brightness = config.brightness || 1.0;
      
      // Si hay un país destacado, volver a aplicar el resplandor con la nueva configuración
      if (highlightedCountryIndex >= 0) {
        updateCountryHighlight(highlightedCountryIndex);
      }
    });

    // Escuchar actualizaciones de transformaciones desde el servidor
    socket.on('transforms_update', (transformsData) => {
      console.log('Transforms update received from server', transformsData);
      
      // Aplicar transformaciones a grupos
      if (transformsData.groups) {
        Object.keys(transformsData.groups).forEach(letter => {
          applyTransform('group', letter, transformsData.groups[letter]);
        });
      }
      
      // Aplicar transformaciones a bombos
      if (transformsData.bombos) {
        Object.keys(transformsData.bombos).forEach(num => {
          applyTransform('bombo', num, transformsData.bombos[num]);
        });
        
        // NO aplicar transformaciones al contenedor de banderas CSS
        // Las banderas CSS ahora usan posición absoluta fija en el canvas 1920x1080
      }
    });
  </script>
</body>
</html>
